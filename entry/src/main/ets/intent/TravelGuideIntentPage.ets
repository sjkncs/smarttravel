import { InsightIntentPage, IntentParams } from '@kit.AbilityKit';
import { hilog } from '@kit.PerformanceAnalysisKit';

const TAG = 'TravelGuideIntentPage';
const DOMAIN = 0x0000;

/**
 * åŸºäºPageçš„æ„å›¾è£…é¥°å™¨ç¤ºä¾‹
 * ç”¨äºç›´æ¥åœ¨é¡µé¢ç»„ä»¶ä¸Šå£°æ˜æ„å›¾ï¼Œå®ç°å¿«é€Ÿæ‹‰èµ·
 * 
 * ä½¿ç”¨åœºæ™¯ï¼š
 * - å·²æœ‰Navigationæ¶æ„çš„é¡µé¢
 * - éœ€è¦å¿«é€Ÿå°†é¡µé¢å¼€æ”¾ä¸ºæ„å›¾å…¥å£
 * 
 * çº¦æŸï¼š
 * - ä»…æ”¯æŒå‰å°æ‰§è¡Œ
 * - ä»…æ”¯æŒNavigationæ¶æ„
 */

/**
 * æ—…æ¸¸æ”»ç•¥è¯¦æƒ…é¡µé¢ï¼ˆä½¿ç”¨æ„å›¾è£…é¥°å™¨ï¼‰
 * ç›´æ¥åœ¨Pageç»„ä»¶ä¸Šæ·»åŠ è£…é¥°å™¨å³å¯å®ç°æ„å›¾æ¥å…¥
 */
@InsightIntentPage({
  // æ„å›¾åç§°
  intentName: 'ViewTravelGuides',
  // æ‰€å±å‚åŸŸ
  domain: 'TravelDomain',
  // æ„å›¾ç‰ˆæœ¬
  intentVersion: '1.0.1',
  // é¡µé¢è·¯ç”±
  route: 'pages/guide/GuideDetailPage',
  // æ„å›¾æè¿°
  description: 'æŸ¥çœ‹æ—…æ¸¸æ”»ç•¥è¯¦æƒ…é¡µé¢'
})
@Entry
@Component
export struct TravelGuideDetailIntentPage {
  @State guideId: string = '';
  @State guideTitle: string = '';
  @State location: string = '';
  
  /**
   * é¡µé¢å³å°†æ˜¾ç¤ºæ—¶è°ƒç”¨
   * ä»æ„å›¾å‚æ•°ä¸­è·å–æ•°æ®
   */
  aboutToAppear() {
    hilog.info(DOMAIN, TAG, '[Page] é¡µé¢åŠ è½½');
    
    // è·å–æ„å›¾ä¼ é€’çš„å‚æ•°
    this.loadIntentParams();
    
    hilog.info(DOMAIN, TAG, `[Page] æ”»ç•¥: id=${this.guideId}, title=${this.guideTitle}, location=${this.location}`);
  }
  
  /**
   * åŠ è½½æ„å›¾å‚æ•°
   * è£…é¥°å™¨ä¼šè‡ªåŠ¨å°†å‚æ•°æ³¨å…¥åˆ°é¡µé¢ä¸­
   */
  private loadIntentParams() {
    // æ–¹å¼1: ä»AppStorageè·å–ï¼ˆå…¼å®¹è€æ–¹å¼ï¼‰
    const storageId = AppStorage.get<string>('intentGuideId');
    const storageName = AppStorage.get<string>('intentGuideName');
    const storageLocation = AppStorage.get<string>('intentGuideLocation');
    
    if (storageId) {
      this.guideId = storageId;
      AppStorage.delete('intentGuideId');
    }
    
    if (storageName) {
      this.guideTitle = storageName;
      AppStorage.delete('intentGuideName');
    }
    
    if (storageLocation) {
      this.location = storageLocation;
      AppStorage.delete('intentGuideLocation');
    }
    
    // æ–¹å¼2: ä»@InsightIntentPageè£…é¥°å™¨æ³¨å…¥çš„å‚æ•°è·å–
    // è£…é¥°å™¨ä¼šè‡ªåŠ¨å¤„ç†å‚æ•°ç»‘å®š
  }
  
  build() {
    NavDestination() {
      Column() {
        // é¡µé¢æ ‡é¢˜
        Text(this.guideTitle || 'æ—…æ¸¸æ”»ç•¥è¯¦æƒ…')
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
          .margin({ top: 20, bottom: 10 })
        
        // ä½ç½®ä¿¡æ¯
        if (this.location) {
          Row() {
            Text('ğŸ“')
              .fontSize(16)
            Text(this.location)
              .fontSize(16)
              .fontColor('#666666')
              .margin({ left: 5 })
          }
          .margin({ bottom: 20 })
        }
        
        // å†…å®¹åŒºåŸŸ
        Scroll() {
          Column() {
            Text('æ”»ç•¥å†…å®¹åŠ è½½ä¸­...')
              .fontSize(16)
              .fontColor('#999999')
              .margin({ top: 50 })
          }
          .width('100%')
        }
        .layoutWeight(1)
      }
      .width('100%')
      .height('100%')
      .padding(20)
      .backgroundColor('#f8f8f8')
    }
    .title('æ”»ç•¥è¯¦æƒ…')
    .hideTitleBar(false)
  }
}

/**
 * æœç´¢ç»“æœé¡µé¢ï¼ˆä½¿ç”¨æ„å›¾è£…é¥°å™¨ï¼‰
 */
@InsightIntentPage({
  intentName: 'SearchDestinations',
  domain: 'TravelDomain',
  intentVersion: '1.0.0',
  route: 'pages/search/SearchResultPage',
  description: 'æœç´¢æ—…æ¸¸ç›®çš„åœ°ç»“æœé¡µ'
})
@Entry
@Component
export struct SearchResultIntentPage {
  @State keyword: string = '';
  @State category: string = '';
  @State results: string[] = [];
  
  aboutToAppear() {
    hilog.info(DOMAIN, TAG, '[Page] æœç´¢é¡µé¢åŠ è½½');
    
    // è·å–æœç´¢å‚æ•°
    const searchKeyword = AppStorage.get<string>('searchKeyword');
    const searchCategory = AppStorage.get<string>('searchCategory');
    
    if (searchKeyword) {
      this.keyword = searchKeyword;
      AppStorage.delete('searchKeyword');
    }
    
    if (searchCategory) {
      this.category = searchCategory;
      AppStorage.delete('searchCategory');
    }
    
    hilog.info(DOMAIN, TAG, `[Page] æœç´¢: keyword=${this.keyword}, category=${this.category}`);
    
    // æ‰§è¡Œæœç´¢
    this.performSearch();
  }
  
  /**
   * æ‰§è¡Œæœç´¢æ“ä½œ
   */
  private performSearch() {
    // æ¨¡æ‹Ÿæœç´¢ç»“æœ
    this.results = [
      `${this.keyword} - æ”»ç•¥1`,
      `${this.keyword} - æ”»ç•¥2`,
      `${this.keyword} - æ”»ç•¥3`
    ];
  }
  
  build() {
    NavDestination() {
      Column() {
        // æœç´¢æ ‡é¢˜
        Text(`æœç´¢: ${this.keyword}`)
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .margin({ top: 20, bottom: 10 })
        
        // åˆ†ç±»æ ‡ç­¾
        if (this.category) {
          Text(`åˆ†ç±»: ${this.category}`)
            .fontSize(14)
            .fontColor('#666666')
            .margin({ bottom: 20 })
        }
        
        // æœç´¢ç»“æœåˆ—è¡¨
        List() {
          ForEach(this.results, (item: string) => {
            ListItem() {
              Text(item)
                .fontSize(16)
                .padding(15)
                .width('100%')
                .backgroundColor(Color.White)
                .borderRadius(8)
            }
            .margin({ bottom: 10 })
          })
        }
        .layoutWeight(1)
        .width('100%')
      }
      .width('100%')
      .height('100%')
      .padding(20)
      .backgroundColor('#f8f8f8')
    }
    .title('æœç´¢ç»“æœ')
  }
}

/**
 * å¤©æ°”é¢„æŠ¥é¡µé¢ï¼ˆä½¿ç”¨æ„å›¾è£…é¥°å™¨ï¼‰
 */
@InsightIntentPage({
  intentName: 'ViewWeather',
  domain: 'TravelDomain',
  intentVersion: '1.0.0',
  route: 'pages/weather/WeatherPage',
  description: 'æŸ¥çœ‹åŸå¸‚å¤©æ°”é¢„æŠ¥'
})
@Entry
@Component
export struct WeatherIntentPage {
  @State cityName: string = 'å½“å‰ä½ç½®';
  @State days: number = 7;
  @State temperature: string = '--';
  @State weather: string = 'åŠ è½½ä¸­...';
  
  aboutToAppear() {
    hilog.info(DOMAIN, TAG, '[Page] å¤©æ°”é¡µé¢åŠ è½½');
    
    // è·å–å¤©æ°”å‚æ•°
    const weatherCity = AppStorage.get<string>('weatherCity');
    const weatherDays = AppStorage.get<number>('weatherDays');
    
    if (weatherCity) {
      this.cityName = weatherCity;
      AppStorage.delete('weatherCity');
    }
    
    if (weatherDays) {
      this.days = weatherDays;
      AppStorage.delete('weatherDays');
    }
    
    hilog.info(DOMAIN, TAG, `[Page] å¤©æ°”æŸ¥è¯¢: city=${this.cityName}, days=${this.days}`);
    
    // åŠ è½½å¤©æ°”æ•°æ®
    this.loadWeatherData();
  }
  
  /**
   * åŠ è½½å¤©æ°”æ•°æ®
   */
  private loadWeatherData() {
    // æ¨¡æ‹Ÿå¤©æ°”æ•°æ®
    this.temperature = '25Â°C';
    this.weather = 'æ™´å¤©';
  }
  
  build() {
    NavDestination() {
      Column() {
        // åŸå¸‚åç§°
        Text(this.cityName)
          .fontSize(28)
          .fontWeight(FontWeight.Bold)
          .margin({ top: 30, bottom: 20 })
        
        // å¤©æ°”å›¾æ ‡å’Œæ¸©åº¦
        Column() {
          Text('â˜€ï¸')
            .fontSize(80)
            .margin({ bottom: 10 })
          
          Text(this.temperature)
            .fontSize(48)
            .fontWeight(FontWeight.Bold)
            .margin({ bottom: 5 })
          
          Text(this.weather)
            .fontSize(20)
            .fontColor('#666666')
        }
        .margin({ bottom: 30 })
        
        // é¢„æŠ¥å¤©æ•°è¯´æ˜
        Text(`æœªæ¥${this.days}å¤©é¢„æŠ¥`)
          .fontSize(16)
          .fontColor('#999999')
        
        // å ä½ç©ºé—´
        Blank()
      }
      .width('100%')
      .height('100%')
      .padding(20)
      .backgroundColor('#e3f2fd')
    }
    .title('å¤©æ°”é¢„æŠ¥')
  }
}
