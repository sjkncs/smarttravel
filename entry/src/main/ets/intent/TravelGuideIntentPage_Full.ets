import { InsightIntentPage } from "@ohos.app.ability.InsightIntentDecorator";
import { hilog } from '@kit.PerformanceAnalysisKit';

const TAG = 'TravelGuideIntentPage';
const DOMAIN = 0x0000;

/**
 * åŸºäºPageçš„æ„å›¾è£…é¥°å™¨å®Œæ•´ç¤ºä¾‹ï¼ˆç¬¦åˆå®˜æ–¹è§„èŒƒï¼‰
 * ä½¿ç”¨HarmonyOS 6.0.0(20)+ çš„å®Œæ•´è£…é¥°å™¨å­—æ®µ
 * 
 * åŒ…å«å­—æ®µï¼š
 * - intentName: æ„å›¾åç§°
 * - domain: åŠŸèƒ½å‚åŸŸ
 * - intentVersion: ç‰ˆæœ¬å·
 * - displayName: å±•ç¤ºåç§°
 * - llmDescription: LLMæè¿°ï¼ˆä¾¿äºAIç†è§£ï¼‰
 * - parameters: å‚æ•°å®šä¹‰ï¼ˆJSON Schemaï¼‰
 * - uiAbility: UIAbilityåç§°
 * - pagePath: Navigationç»„ä»¶æ‰€åœ¨é¡µé¢è·¯å¾„
 * - navDestinationName: Navigationå­é¡µé¢åç§°
 */

/**
 * Builderå‡½æ•° - æŸ¥çœ‹æ—…æ¸¸æ”»ç•¥é¡µé¢
 * å¿…é¡»å®šä¹‰Builderå‡½æ•°ä»¥æ”¯æŒåŠ¨æ€åˆ›å»ºé¡µé¢å®ä¾‹
 */
@Builder
export function TravelGuideDetailPageBuilder(pageName: string, param: object) {
  TravelGuideDetailPage({ param: param });
}

/**
 * æŸ¥çœ‹æ—…æ¸¸æ”»ç•¥æ„å›¾é¡µé¢ï¼ˆå®Œæ•´è§„èŒƒç‰ˆæœ¬ï¼‰
 */
@InsightIntentPage({
  // 1. åŸºæœ¬ä¿¡æ¯
  intentName: 'ViewTravelGuides',
  domain: 'TravelDomain',
  intentVersion: '1.0.1',
  displayName: 'æŸ¥çœ‹æ—…æ¸¸æ”»ç•¥',
  
  // 2. LLMæè¿°ï¼ˆå¸®åŠ©AIç†è§£ä½•æ—¶è°ƒç”¨ï¼‰
  llmDescription: 'ç”¨äºæŸ¥çœ‹å’Œæµè§ˆæ—…æ¸¸æ”»ç•¥è¯¦æƒ…ï¼Œå…è®¸ç”¨æˆ·æŸ¥çœ‹ç‰¹å®šåŸå¸‚æˆ–æ™¯ç‚¹çš„æ—…æ¸¸æ”»ç•¥ä¿¡æ¯ã€‚' +
    'åœ¨ç”¨æˆ·æ˜ç¡®è¡¨è¾¾æƒ³è¦æŸ¥çœ‹æ”»ç•¥éœ€æ±‚æ—¶ä½¿ç”¨ï¼Œä¾‹å¦‚"æŸ¥çœ‹æ·±åœ³æ—…æ¸¸æ”»ç•¥"ã€"å¸®æˆ‘çœ‹çœ‹åŒ—äº¬çš„æ”»ç•¥"ã€"æ‰“å¼€å¹¿å·æ—…æ¸¸æŒ‡å—"ç­‰ã€‚' +
    'å¦‚æœç”¨æˆ·åªæ˜¯è¯¢é—®æ”»ç•¥æ˜¯å¦å­˜åœ¨ã€æ”»ç•¥æ•°é‡ã€æ”»ç•¥ä½œè€…æˆ–æ”»ç•¥è¯„åˆ†ï¼Œä¸åº”è°ƒç”¨æ­¤å·¥å…·ã€‚' +
    'å¦‚æœç”¨æˆ·éœ€è¦ç¼–è¾‘æˆ–åˆ›å»ºæ”»ç•¥ï¼Œä¸åº”è°ƒç”¨æ­¤å·¥å…·ã€‚' +
    'å¿…éœ€å‚æ•°ï¼šåŸå¸‚åç§°ï¼ˆcityNameï¼‰æˆ–æ”»ç•¥IDï¼ˆguideIdï¼‰è‡³å°‘æä¾›å…¶ä¸€ã€‚',
  
  // 3. Navigationé…ç½®
  uiAbility: 'EntryAbility',                          // UIAbilityåç§°ï¼ˆå¯çœç•¥ï¼Œé»˜è®¤EntryAbilityï¼‰
  pagePath: './ets/pages/MainPage',                   // Navigationç»„ä»¶æ‰€åœ¨é¡µé¢è·¯å¾„
  navDestinationName: 'TravelGuideDetailPage',        // Navigationå­é¡µé¢åç§°
  
  // 4. å‚æ•°å®šä¹‰ï¼ˆJSON Schemaè§„èŒƒï¼‰
  parameters: {
    "type": "object",
    "properties": {
      "guideId": {
        "type": "string",
        "description": "æ”»ç•¥å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºç²¾ç¡®å®šä½ç‰¹å®šæ”»ç•¥"
      },
      "cityName": {
        "type": "string",
        "description": "ç›®æ ‡åŸå¸‚åç§°ï¼Œå¦‚'æ·±åœ³'ã€'åŒ—äº¬'ã€'ä¸Šæµ·'ã€'å¹¿å·'ç­‰å›½å†…ä¸»è¦åŸå¸‚"
      },
      "category": {
        "type": "string",
        "description": "æ”»ç•¥åˆ†ç±»ï¼Œæ”¯æŒçš„ç±»å‹åŒ…æ‹¬ï¼šç¾é£Ÿã€æ™¯ç‚¹ã€ä½å®¿ã€äº¤é€šã€è´­ç‰©",
        "enum": ["ç¾é£Ÿ", "æ™¯ç‚¹", "ä½å®¿", "äº¤é€š", "è´­ç‰©"]
      },
      "keywords": {
        "type": "string",
        "description": "æœç´¢å…³é”®è¯ï¼Œç”¨äºåœ¨æ”»ç•¥ä¸­æŸ¥æ‰¾ç‰¹å®šå†…å®¹"
      }
    },
    "required": ["cityName"]
  }
})
@Entry
@Component
struct TravelGuideDetailPage {
  // å‚æ•°å¯¹è±¡ - å¿…é¡»å®šä¹‰ï¼Œç”¨äºæ¥æ”¶æ„å›¾å‚æ•°
  param: object = new Object();
  
  // çŠ¶æ€å˜é‡ - ä»paramä¸­æå–çš„å‚æ•°
  @State guideId: string = '';
  @State cityName: string = '';
  @State category: string = '';
  @State keywords: string = '';
  
  // é¡µé¢æ•°æ®
  @State guideTitle: string = 'æ—…æ¸¸æ”»ç•¥';
  @State guideContent: string = '';
  @State guideAuthor: string = '';
  @State viewCount: number = 0;
  
  /**
   * é¡µé¢å³å°†æ˜¾ç¤ºæ—¶è°ƒç”¨
   * ä»paramå¯¹è±¡ä¸­æå–æ„å›¾å‚æ•°
   */
  aboutToAppear(): void {
    hilog.info(DOMAIN, TAG, '[Page] æ”»ç•¥è¯¦æƒ…é¡µé¢åŠ è½½');
    hilog.info(DOMAIN, TAG, `[Page] æ¥æ”¶å‚æ•°: ${JSON.stringify(this.param)}`);
    
    // ä»paramä¸­æå–å‚æ•°ï¼ˆä½¿ç”¨å¯é€‰é“¾å’Œé»˜è®¤å€¼ï¼‰
    this.guideId = this.param?.['guideId'] || '';
    this.cityName = this.param?.['cityName'] || '';
    this.category = this.param?.['category'] || '';
    this.keywords = this.param?.['keywords'] || '';
    
    hilog.info(DOMAIN, TAG, 
      `[Page] è§£æå‚æ•° - ID: ${this.guideId}, åŸå¸‚: ${this.cityName}, ` +
      `åˆ†ç±»: ${this.category}, å…³é”®è¯: ${this.keywords}`
    );
    
    // å‚æ•°éªŒè¯
    if (!this.cityName && !this.guideId) {
      hilog.error(DOMAIN, TAG, '[Page] ç¼ºå°‘å¿…éœ€å‚æ•°ï¼šcityNameæˆ–guideId');
      this.showError('ç¼ºå°‘å¿…éœ€å‚æ•°');
      return;
    }
    
    // æ ¹æ®å‚æ•°åŠ è½½æ”»ç•¥æ•°æ®
    this.loadGuideData();
  }
  
  /**
   * åŠ è½½æ”»ç•¥æ•°æ®
   */
  private loadGuideData(): void {
    // æ ¹æ®åŸå¸‚åç§°åŠ è½½ç›¸åº”æ”»ç•¥
    if (this.cityName === 'æ·±åœ³') {
      this.guideTitle = 'æ·±åœ³æ—…æ¸¸æ”»ç•¥';
      this.guideContent = 'æ·±åœ³æ˜¯ä¸€åº§ç°ä»£åŒ–éƒ½å¸‚ï¼Œæ‹¥æœ‰ä¸–ç•Œä¹‹çª—ã€æ¬¢ä¹è°·ã€ä¸œéƒ¨åä¾¨åŸç­‰è‘—åæ™¯ç‚¹ã€‚' +
        'è¿™é‡Œæ—¢æœ‰ç¹åçš„å•†ä¸šåŒºï¼Œä¹Ÿæœ‰ç¾ä¸½çš„æµ·æ»¨é£å…‰ã€‚æ¨èæ™¯ç‚¹åŒ…æ‹¬æ·±åœ³æ¹¾å…¬å›­ã€è²èŠ±å±±å…¬å›­ç­‰ã€‚';
      this.guideAuthor = 'æ—…æ¸¸è¾¾äººå°å¼ ';
      this.viewCount = 12580;
    } else if (this.cityName === 'åŒ—äº¬') {
      this.guideTitle = 'åŒ—äº¬æ—…æ¸¸æ”»ç•¥';
      this.guideContent = 'åŒ—äº¬æ˜¯ä¸­å›½çš„é¦–éƒ½ï¼Œæ‹¥æœ‰æ•…å®«ã€é•¿åŸã€å¤©å›ç­‰ä¸–ç•Œæ–‡åŒ–é—äº§ã€‚' +
        'è¿™é‡Œå†å²æ‚ ä¹…ï¼Œæ–‡åŒ–åº•è•´æ·±åšã€‚å¿…æ¸¸æ™¯ç‚¹åŒ…æ‹¬æ•…å®«åšç‰©é™¢ã€å…«è¾¾å²­é•¿åŸã€é¢å’Œå›­ç­‰ã€‚';
      this.guideAuthor = 'åŒ—äº¬é€šè€ç‹';
      this.viewCount = 35820;
    } else if (this.cityName === 'ä¸Šæµ·') {
      this.guideTitle = 'ä¸Šæµ·æ—…æ¸¸æ”»ç•¥';
      this.guideContent = 'ä¸Šæµ·æ˜¯å›½é™…åŒ–å¤§éƒ½å¸‚ï¼Œæ‹¥æœ‰å¤–æ»©ã€ä¸œæ–¹æ˜ç ã€è±«å›­ç­‰è‘—åæ™¯ç‚¹ã€‚' +
        'è¿™é‡Œèåˆäº†ä¸œè¥¿æ–¹æ–‡åŒ–ï¼Œæ—¢æœ‰ç°ä»£æ‘©å¤©å¤§æ¥¼ï¼Œä¹Ÿæœ‰ä¼ ç»ŸçŸ³åº“é—¨å»ºç­‘ã€‚';
      this.guideAuthor = 'é­”éƒ½å°åƒè´§';
      this.viewCount = 28960;
    } else {
      this.guideTitle = `${this.cityName}æ—…æ¸¸æ”»ç•¥`;
      this.guideContent = `${this.cityName}çš„æ—…æ¸¸ä¿¡æ¯æ­£åœ¨åŠ è½½ä¸­ï¼Œè¯·ç¨å€™...`;
      this.guideAuthor = 'ç³»ç»Ÿæ¨è';
      this.viewCount = 0;
    }
    
    // å¦‚æœæœ‰åˆ†ç±»ï¼Œæ·»åŠ åˆ°æ ‡é¢˜
    if (this.category) {
      this.guideTitle += ` - ${this.category}`;
    }
    
    hilog.info(DOMAIN, TAG, `[Page] åŠ è½½å®Œæˆ - æ ‡é¢˜: ${this.guideTitle}`);
  }
  
  /**
   * æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
   */
  private showError(message: string): void {
    this.guideTitle = 'åŠ è½½å¤±è´¥';
    this.guideContent = message;
  }
  
  build() {
    NavDestination() {
      Column() {
        // æ ‡é¢˜åŒºåŸŸ
        Column() {
          Text(this.guideTitle)
            .fontSize(24)
            .fontWeight(FontWeight.Bold)
            .margin({ bottom: 10 })
          
          // åŸå¸‚å’Œåˆ†ç±»ä¿¡æ¯
          Row({ space: 15 }) {
            if (this.cityName) {
              Row({ space: 5 }) {
                Text('ğŸ“')
                  .fontSize(16)
                Text(this.cityName)
                  .fontSize(14)
                  .fontColor('#666666')
              }
            }
            
            if (this.category) {
              Row({ space: 5 }) {
                Text('ğŸ·ï¸')
                  .fontSize(16)
                Text(this.category)
                  .fontSize(14)
                  .fontColor('#666666')
              }
            }
          }
          .margin({ bottom: 10 })
          
          // ä½œè€…å’Œæµè§ˆé‡
          if (this.guideAuthor) {
            Row({ space: 20 }) {
              Text(`ä½œè€…: ${this.guideAuthor}`)
                .fontSize(12)
                .fontColor('#999999')
              
              if (this.viewCount > 0) {
                Text(`æµè§ˆ: ${this.viewCount}`)
                  .fontSize(12)
                  .fontColor('#999999')
              }
            }
          }
        }
        .width('100%')
        .alignItems(HorizontalAlign.Start)
        .padding(20)
        .backgroundColor(Color.White)
        
        Divider()
          .margin({ vertical: 10 })
        
        // å†…å®¹åŒºåŸŸ
        Scroll() {
          Column() {
            Text(this.guideContent)
              .fontSize(16)
              .lineHeight(28)
              .fontColor('#333333')
          }
          .width('100%')
          .padding(20)
        }
        .layoutWeight(1)
        .backgroundColor(Color.White)
        
      }
      .width('100%')
      .height('100%')
      .backgroundColor('#F5F5F5')
    }
    .title('æ”»ç•¥è¯¦æƒ…')
    .width('100%')
  }
}

/**
 * Builderå‡½æ•° - é¢„è®¢é…’åº—é¡µé¢
 */
@Builder
export function HotelBookingPageBuilder(pageName: string, param: object) {
  HotelBookingPage({ param: param });
}

/**
 * é¢„è®¢é…’åº—æˆ¿é—´æ„å›¾é¡µé¢
 */
@InsightIntentPage({
  intentName: 'BookHotelRoom',
  domain: 'TravelDomain',
  intentVersion: '1.0.0',
  displayName: 'é¢„è®¢é…’åº—æˆ¿é—´',
  
  llmDescription: 'ç”¨äºåœ¨çº¿é¢„è®¢é…’åº—æˆ¿é—´ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©æŒ‡å®šåŸå¸‚ã€é…’åº—ã€å…¥ä½æ—¥æœŸå’Œæˆ¿å‹è¿›è¡Œé¢„è®¢ã€‚' +
    'åœ¨ç”¨æˆ·æ˜ç¡®è¡¨è¾¾é¢„è®¢éœ€æ±‚ï¼Œä¸”å·²æä¾›æ‰€æœ‰å¿…è¦ä¿¡æ¯ï¼ˆcity, hotel, checkIn, checkOutï¼‰æ—¶ä½¿ç”¨ã€‚' +
    'ä¾‹å¦‚"é¢„è®¢æ·±åœ³å¸Œå°”é¡¿é…’åº—æ˜å¤©çš„æˆ¿é—´"ã€"å¸®æˆ‘è®¢ä¸€ä¸ªåŒ—äº¬çš„é…’åº—ï¼Œ12æœˆ1å·å…¥ä½"ç­‰ã€‚' +
    'å¦‚æœä¿¡æ¯ä¸å…¨æˆ–ç”¨æˆ·åªæ˜¯æŸ¥è¯¢é…’åº—ä¿¡æ¯ã€ä»·æ ¼æˆ–æˆ¿é—´ç±»å‹ï¼Œä¸åº”è°ƒç”¨æ­¤å·¥å…·ã€‚' +
    'å¦‚æœç”¨æˆ·éœ€è¦å–æ¶ˆæˆ–ä¿®æ”¹è®¢å•ï¼Œä¸åº”è°ƒç”¨æ­¤å·¥å…·ã€‚' +
    'å¿…éœ€å‚æ•°ï¼šåŸå¸‚ï¼ˆcityï¼‰ã€é…’åº—åç§°ï¼ˆhotelï¼‰ã€å…¥ä½æ—¥æœŸï¼ˆcheckInï¼‰ã€é€€æˆ¿æ—¥æœŸï¼ˆcheckOutï¼‰ã€‚',
  
  pagePath: './ets/pages/MainPage',
  navDestinationName: 'HotelBookingPage',
  
  parameters: {
    "type": "object",
    "properties": {
      "city": {
        "type": "string",
        "description": "é…’åº—æ‰€åœ¨åŸå¸‚åç§°"
      },
      "hotel": {
        "type": "string",
        "description": "é…’åº—åç§°ï¼Œéœ€ä¸ºå¹³å°åˆä½œçš„é…’åº—"
      },
      "checkIn": {
        "type": "string",
        "description": "å…¥ä½æ—¥æœŸï¼Œæ ¼å¼ä¸º'YYYY-MM-DD'ï¼Œä¾‹å¦‚'2025-11-27'ï¼Œå¿…é¡»ä¸ºæœªæ¥æ—¥æœŸ"
      },
      "checkOut": {
        "type": "string",
        "description": "é€€æˆ¿æ—¥æœŸï¼Œæ ¼å¼ä¸º'YYYY-MM-DD'ï¼Œå¿…é¡»æ™šäºå…¥ä½æ—¥æœŸ"
      },
      "roomType": {
        "type": "string",
        "description": "æˆ¿å‹ç±»å‹ï¼Œå¦‚'æ ‡å‡†é—´'ã€'å¤§åºŠæˆ¿'ã€'å¥—æˆ¿'ã€'è±ªåæˆ¿'ç­‰"
      },
      "guests": {
        "type": "number",
        "description": "å…¥ä½äººæ•°ï¼Œå–å€¼èŒƒå›´1-4ï¼Œé»˜è®¤ä¸º1"
      }
    },
    "required": ["city", "hotel", "checkIn", "checkOut"]
  }
})
@Entry
@Component
struct HotelBookingPage {
  param: object = new Object();
  
  @State city: string = '';
  @State hotel: string = '';
  @State checkIn: string = '';
  @State checkOut: string = '';
  @State roomType: string = 'æ ‡å‡†é—´';
  @State guests: number = 1;
  @State totalPrice: number = 0;
  
  aboutToAppear(): void {
    hilog.info(DOMAIN, TAG, '[Page] é…’åº—é¢„è®¢é¡µé¢åŠ è½½');
    
    // æå–å‚æ•°
    this.city = this.param?.['city'] || '';
    this.hotel = this.param?.['hotel'] || '';
    this.checkIn = this.param?.['checkIn'] || '';
    this.checkOut = this.param?.['checkOut'] || '';
    this.roomType = this.param?.['roomType'] || 'æ ‡å‡†é—´';
    this.guests = this.param?.['guests'] || 1;
    
    hilog.info(DOMAIN, TAG, 
      `[Page] é¢„è®¢ä¿¡æ¯ - åŸå¸‚: ${this.city}, é…’åº—: ${this.hotel}, ` +
      `å…¥ä½: ${this.checkIn}, é€€æˆ¿: ${this.checkOut}`
    );
    
    // å‚æ•°éªŒè¯
    if (!this.city || !this.hotel || !this.checkIn || !this.checkOut) {
      hilog.error(DOMAIN, TAG, '[Page] ç¼ºå°‘å¿…éœ€å‚æ•°');
      return;
    }
    
    // éªŒè¯æ—¥æœŸ
    if (!this.validateDates()) {
      hilog.error(DOMAIN, TAG, '[Page] æ—¥æœŸéªŒè¯å¤±è´¥');
      return;
    }
    
    // è®¡ç®—ä»·æ ¼
    this.calculatePrice();
  }
  
  /**
   * éªŒè¯æ—¥æœŸæœ‰æ•ˆæ€§
   */
  private validateDates(): boolean {
    try {
      const inDate = new Date(this.checkIn);
      const outDate = new Date(this.checkOut);
      const today = new Date();
      
      if (isNaN(inDate.getTime()) || isNaN(outDate.getTime())) {
        return false;
      }
      
      if (inDate < today) {
        return false;
      }
      
      if (outDate <= inDate) {
        return false;
      }
      
      return true;
    } catch (error) {
      return false;
    }
  }
  
  /**
   * è®¡ç®—æ€»ä»·
   */
  private calculatePrice(): void {
    const nights = this.calculateNights();
    const pricePerNight = this.roomType === 'å¥—æˆ¿' ? 800 : 
                          this.roomType === 'å¤§åºŠæˆ¿' ? 500 : 350;
    this.totalPrice = nights * pricePerNight;
  }
  
  /**
   * è®¡ç®—ä½å®¿å¤©æ•°
   */
  private calculateNights(): number {
    const inDate = new Date(this.checkIn);
    const outDate = new Date(this.checkOut);
    const diffTime = outDate.getTime() - inDate.getTime();
    return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  }
  
  build() {
    NavDestination() {
      Column({ space: 0 }) {
        // é…’åº—ä¿¡æ¯å¡ç‰‡
        Column({ space: 10 }) {
          Text(this.hotel)
            .fontSize(22)
            .fontWeight(FontWeight.Bold)
          
          Row({ space: 5 }) {
            Text('ğŸ“')
              .fontSize(16)
            Text(this.city)
              .fontSize(16)
              .fontColor('#666666')
          }
        }
        .width('100%')
        .padding(20)
        .backgroundColor(Color.White)
        .alignItems(HorizontalAlign.Start)
        
        Divider().height(8).color('#F5F5F5')
        
        // é¢„è®¢ä¿¡æ¯
        Column({ space: 15 }) {
          this.InfoRow('å…¥ä½æ—¥æœŸ', this.checkIn)
          this.InfoRow('é€€æˆ¿æ—¥æœŸ', this.checkOut)
          this.InfoRow('ä½å®¿å¤©æ•°', `${this.calculateNights()}æ™š`)
          this.InfoRow('æˆ¿å‹', this.roomType)
          this.InfoRow('å…¥ä½äººæ•°', `${this.guests}äºº`)
        }
        .width('100%')
        .padding(20)
        .backgroundColor(Color.White)
        .alignItems(HorizontalAlign.Start)
        
        Divider().height(8).color('#F5F5F5')
        
        // ä»·æ ¼ä¿¡æ¯
        Column({ space: 10 }) {
          Row() {
            Text('æ€»ä»·')
              .fontSize(18)
              .fontWeight(FontWeight.Medium)
            Blank()
            Text(`Â¥${this.totalPrice}`)
              .fontSize(24)
              .fontWeight(FontWeight.Bold)
              .fontColor('#FF6B6B')
          }
          .width('100%')
        }
        .width('100%')
        .padding(20)
        .backgroundColor(Color.White)
        
        Spacer()
        
        // é¢„è®¢æŒ‰é’®
        Button('ç¡®è®¤é¢„è®¢')
          .width('90%')
          .height(50)
          .fontSize(18)
          .backgroundColor('#FF6B6B')
          .margin({ bottom: 20 })
          .onClick(() => {
            hilog.info(DOMAIN, TAG, '[Page] ç¡®è®¤é¢„è®¢');
          })
      }
      .width('100%')
      .height('100%')
      .backgroundColor('#F5F5F5')
    }
    .title('é¢„è®¢é…’åº—')
  }
  
  @Builder
  InfoRow(label: string, value: string) {
    Row() {
      Text(label)
        .fontSize(16)
        .fontColor('#666666')
      Blank()
      Text(value)
        .fontSize(16)
        .fontWeight(FontWeight.Medium)
    }
    .width('100%')
  }
}

/**
 * Builderå‡½æ•° - æœç´¢ç›®çš„åœ°é¡µé¢
 */
@Builder
export function SearchDestinationsPageBuilder(pageName: string, param: object) {
  SearchDestinationsPage({ param: param });
}

/**
 * æœç´¢æ—…æ¸¸ç›®çš„åœ°æ„å›¾é¡µé¢
 */
@InsightIntentPage({
  intentName: 'SearchDestinations',
  domain: 'TravelDomain',
  intentVersion: '1.0.0',
  displayName: 'æœç´¢æ—…æ¸¸ç›®çš„åœ°',
  
  llmDescription: 'ç”¨äºæœç´¢æ—…æ¸¸ç›®çš„åœ°ï¼Œå…è®¸ç”¨æˆ·æ ¹æ®å…³é”®è¯ã€åˆ†ç±»æˆ–ç‰¹ç‚¹æŸ¥æ‰¾åˆé€‚çš„æ—…æ¸¸åœ°ç‚¹ã€‚' +
    'åœ¨ç”¨æˆ·è¡¨è¾¾æœç´¢æ„å›¾æ—¶ä½¿ç”¨ï¼Œå¦‚"æ‰¾æµ·å²›æ—…æ¸¸"ã€"æœç´¢å¤é•‡"ã€"æŸ¥æ‰¾é€‚åˆäº²å­æ¸¸çš„åœ°æ–¹"ã€"å¯»æ‰¾å±±å²³æ™¯ç‚¹"ç­‰ã€‚' +
    'å¦‚æœç”¨æˆ·åªæ˜¯è¯¢é—®æŸä¸ªå…·ä½“æ™¯ç‚¹çš„ä¿¡æ¯ã€é—¨ç¥¨ä»·æ ¼æˆ–å¼€æ”¾æ—¶é—´ï¼Œåº”ä½¿ç”¨æŸ¥çœ‹æ™¯ç‚¹è¯¦æƒ…åŠŸèƒ½ã€‚' +
    'å¦‚æœç”¨æˆ·æƒ³è¦æŸ¥çœ‹å·²ä¿å­˜çš„æ”¶è—æˆ–å†å²è®°å½•ï¼Œä¸åº”è°ƒç”¨æ­¤å·¥å…·ã€‚' +
    'å¿…éœ€å‚æ•°ï¼šæœç´¢å…³é”®è¯ï¼ˆkeywordï¼‰ã€‚',
  
  pagePath: './ets/pages/MainPage',
  navDestinationName: 'SearchDestinationsPage',
  
  parameters: {
    "type": "object",
    "properties": {
      "keyword": {
        "type": "string",
        "description": "æœç´¢å…³é”®è¯ï¼Œå¦‚'æµ·å²›'ã€'å¤é•‡'ã€'è‰åŸ'ã€'é›ªå±±'ç­‰"
      },
      "category": {
        "type": "string",
        "description": "ç›®çš„åœ°åˆ†ç±»ç±»å‹",
        "enum": ["è‡ªç„¶é£å…‰", "äººæ–‡å†å²", "ä¼‘é—²åº¦å‡", "æ¢é™©åˆºæ¿€", "äº²å­æ¸¸", "èœœæœˆæ¸¸"]
      },
      "budget": {
        "type": "string",
        "description": "é¢„ç®—èŒƒå›´çº§åˆ«",
        "enum": ["ç»æµå‹", "èˆ’é€‚å‹", "è±ªåå‹"]
      },
      "duration": {
        "type": "number",
        "description": "è®¡åˆ’æ—…è¡Œå¤©æ•°ï¼Œå¦‚3ã€5ã€7ã€10ã€15ç­‰"
      }
    },
    "required": ["keyword"]
  }
})
@Entry
@Component
struct SearchDestinationsPage {
  param: object = new Object();
  
  @State keyword: string = '';
  @State category: string = '';
  @State budget: string = '';
  @State duration: number = 0;
  @State searchResults: Array<{name: string, tag: string, price: string}> = [];
  
  aboutToAppear(): void {
    hilog.info(DOMAIN, TAG, '[Page] æœç´¢é¡µé¢åŠ è½½');
    
    this.keyword = this.param?.['keyword'] || '';
    this.category = this.param?.['category'] || '';
    this.budget = this.param?.['budget'] || '';
    this.duration = this.param?.['duration'] || 0;
    
    hilog.info(DOMAIN, TAG, 
      `[Page] æœç´¢æ¡ä»¶ - å…³é”®è¯: ${this.keyword}, åˆ†ç±»: ${this.category}, ` +
      `é¢„ç®—: ${this.budget}, å¤©æ•°: ${this.duration}`
    );
    
    if (!this.keyword) {
      hilog.error(DOMAIN, TAG, '[Page] ç¼ºå°‘æœç´¢å…³é”®è¯');
      return;
    }
    
    this.performSearch();
  }
  
  /**
   * æ‰§è¡Œæœç´¢
   */
  private performSearch(): void {
    // æ ¹æ®å…³é”®è¯è¿”å›æ¨¡æ‹Ÿç»“æœ
    if (this.keyword.includes('æµ·å²›')) {
      this.searchResults = [
        { name: 'ä¸‰äºš', tag: 'çƒ­å¸¦æµ·å²›', price: 'Â¥3000èµ·' },
        { name: 'é©¬å°”ä»£å¤«', tag: 'æµ·å²›å¤©å ‚', price: 'Â¥15000èµ·' },
        { name: 'æ™®å‰å²›', tag: 'ä¸œå—äºšæµ·å²›', price: 'Â¥4000èµ·' },
        { name: 'å·´å˜å²›', tag: 'åº¦å‡èƒœåœ°', price: 'Â¥5000èµ·' }
      ];
    } else if (this.keyword.includes('å¤é•‡')) {
      this.searchResults = [
        { name: 'ä¹Œé•‡', tag: 'æ±Ÿå—æ°´ä¹¡', price: 'Â¥1200èµ·' },
        { name: 'å‘¨åº„', tag: 'ä¸­å›½ç¬¬ä¸€æ°´ä¹¡', price: 'Â¥1000èµ·' },
        { name: 'è¥¿å¡˜', tag: 'ç”Ÿæ´»ç€çš„åƒå¹´å¤é•‡', price: 'Â¥800èµ·' },
        { name: 'åŒé‡Œ', tag: 'ä¸œæ–¹å¨å°¼æ–¯', price: 'Â¥900èµ·' }
      ];
    } else {
      this.searchResults = [
        { name: `${this.keyword}æ¨èåœ°1`, tag: 'çƒ­é—¨æ™¯ç‚¹', price: 'Â¥2000èµ·' },
        { name: `${this.keyword}æ¨èåœ°2`, tag: 'ç‰¹è‰²ä½“éªŒ', price: 'Â¥2500èµ·' },
        { name: `${this.keyword}æ¨èåœ°3`, tag: 'ç»å…¸è·¯çº¿', price: 'Â¥1800èµ·' }
      ];
    }
    
    hilog.info(DOMAIN, TAG, `[Page] æœç´¢å®Œæˆï¼Œæ‰¾åˆ°${this.searchResults.length}ä¸ªç»“æœ`);
  }
  
  build() {
    NavDestination() {
      Column({ space: 0 }) {
        // æœç´¢æ¡ä»¶å±•ç¤º
        Column({ space: 10 }) {
          Text(`æœç´¢: ${this.keyword}`)
            .fontSize(20)
            .fontWeight(FontWeight.Bold)
          
          Row({ space: 10 }) {
            if (this.category) {
              Text(this.category)
                .fontSize(14)
                .fontColor('#666666')
                .padding({ horizontal: 10, vertical: 5 })
                .backgroundColor('#F0F0F0')
                .borderRadius(4)
            }
            
            if (this.budget) {
              Text(this.budget)
                .fontSize(14)
                .fontColor('#666666')
                .padding({ horizontal: 10, vertical: 5 })
                .backgroundColor('#F0F0F0')
                .borderRadius(4)
            }
            
            if (this.duration > 0) {
              Text(`${this.duration}å¤©`)
                .fontSize(14)
                .fontColor('#666666')
                .padding({ horizontal: 10, vertical: 5 })
                .backgroundColor('#F0F0F0')
                .borderRadius(4)
            }
          }
        }
        .width('100%')
        .padding(20)
        .backgroundColor(Color.White)
        .alignItems(HorizontalAlign.Start)
        
        Divider().height(8).color('#F5F5F5')
        
        // æœç´¢ç»“æœ
        Text(`æ‰¾åˆ° ${this.searchResults.length} ä¸ªç»“æœ`)
          .fontSize(14)
          .fontColor('#999999')
          .margin({ left: 20, top: 15, bottom: 10 })
        
        List({ space: 10 }) {
          ForEach(this.searchResults, (item: {name: string, tag: string, price: string}) => {
            ListItem() {
              Row() {
                Column({ space: 5 }) {
                  Text(item.name)
                    .fontSize(18)
                    .fontWeight(FontWeight.Medium)
                  
                  Text(item.tag)
                    .fontSize(14)
                    .fontColor('#999999')
                }
                .alignItems(HorizontalAlign.Start)
                
                Blank()
                
                Text(item.price)
                  .fontSize(16)
                  .fontColor('#FF6B6B')
                  .fontWeight(FontWeight.Bold)
              }
              .width('100%')
              .padding(15)
              .backgroundColor(Color.White)
              .borderRadius(8)
            }
            .margin({ horizontal: 15 })
          })
        }
        .layoutWeight(1)
        .margin({ top: 10 })
      }
      .width('100%')
      .height('100%')
      .backgroundColor('#F5F5F5')
    }
    .title('æœç´¢ç»“æœ')
  }
}
