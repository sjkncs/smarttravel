import { Prompt, router } from "@kit.ArkUI";
import { TopNavigationBar } from '../../components/TopNavigationBar';

interface ServiceItem {
  icon: string;
  name: string;
  description: string;
  color: string;
}

interface OrderItem {
  route: string;
  status: string;
  date: string;
  time: string;
  flightNumber: string;
  price: string;
}

@Entry
@Component
export struct CustomerServicePage {
  @State userName: string = 'syt';
  @State userLevel: string = 'ç™½é“¶è´µå®¾';
  @State isCheckedIn: boolean = false;
  @State checkInDays: number = 0;

  private serviceItems: ServiceItem[] = [
    { icon: 'ğŸ“', name: 'åœ¨çº¿å®¢æœ', description: '7Ã—24å°æ—¶åœ¨çº¿æœåŠ¡', color: '#3b82f6' },
    { icon: 'ğŸ“±', name: 'ç”µè¯å®¢æœ', description: '400-123-4567', color: '#10b981' },
    { icon: 'ğŸ’¬', name: 'å¾®ä¿¡å®¢æœ', description: 'æ‰«ç æ·»åŠ å®¢æœå¾®ä¿¡', color: '#06b6d4' },
    { icon: 'ğŸ“§', name: 'é‚®ä»¶å®¢æœ', description: 'service@smarttravel.com', color: '#8b5cf6' }
  ];

  private orderItems: OrderItem[] = [
    {
      route: 'åˆè‚¥-æ·±åœ³',
      status: 'å·²å‡ºç¥¨',
      date: '8æœˆ27æ—¥',
      time: '06:35',
      flightNumber: 'CZ8596',
      price: 'Â¥530'
    },
    {
      route: 'æ·±åœ³-åˆè‚¥',
      status: 'å·²å‡ºç¥¨',
      date: '1æœˆ8æ—¥',
      time: '07:20',
      flightNumber: 'CZ8595',
      price: 'Â¥528'
    }
  ];

  private quickActions: ServiceItem[] = [
    { icon: 'ğŸ“‹', name: 'æˆ‘è¦å¼€å‘ç¥¨', description: 'ç”µå­å‘ç¥¨ç”³è¯·', color: '#f59e0b' },
    { icon: 'ğŸ“„', name: 'æŠ¥é”€è¡Œç¨‹å•', description: 'è¡Œç¨‹å•ä¸‹è½½', color: '#ef4444' },
    { icon: 'ğŸ”', name: 'æŸ¥è¯¢è®¢å•', description: 'è®¢å•çŠ¶æ€æŸ¥è¯¢', color: '#6366f1' },
    { icon: 'ğŸ’°', name: 'æˆ‘è¦æŠ¥é”€', description: 'æŠ¥é”€ç”³è¯·', color: '#84cc16' },
    { icon: 'ğŸ‘¤', name: 'ä¹˜å®¢ä¿¡æ¯', description: 'æŸ¥çœ‹ä¹˜å®¢è¯¦æƒ…', color: '#ec4899' }
  ];

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      TopNavigationBar({
        title: 'å®¢æœä¸­å¿ƒ',
        showBack: true,
        showSearch: false,
        showNotification: false
      })
      
      Scroll() {
        Column() {
          // æ¬¢è¿æ¨ªå¹…
          this.WelcomeBanner()
          
          // ç­¾åˆ°åŠŸèƒ½
          this.CheckInCard()
          
          // è®¢å•é€‰æ‹©åŒºåŸŸ
          this.OrderSelectionCard()
          
          // å¿«æ·æœåŠ¡
          this.QuickServiceCard()
          
          // æ¨èæœåŠ¡
          this.RecommendedServiceCard()
          
          // åº•éƒ¨å®¢æœå…¥å£
          this.BottomServiceCard()
        }
        .width('100%')
        .backgroundColor('#f8fafc')
        .padding({ bottom: 20 })
      }
      .layoutWeight(1)
      .scrollBar(BarState.Off)
    }
    .width('100%')
    .layoutWeight(1)
    .backgroundColor('#f8fafc')
  }

  @Builder WelcomeBanner() {
    Column() {
      Row() {
        // å®¢æœå¤´åƒ
        Column() {
          Text('ğŸ‘©â€ğŸ’¼')
            .fontSize(48)
            .margin({ bottom: 8 })
          
          // æ ‡ç­¾
          Row({ space: 8 }) {
            Text('æ”¾å¿ƒ')
              .fontSize(12)
              .fontColor('#3b82f6')
              .backgroundColor('#dbeafe')
              .padding({ left: 8, right: 8, top: 4, bottom: 4 })
              .borderRadius(12)
            
            Text('ä¸“ä¸š')
              .fontSize(12)
              .fontColor('#10b981')
              .backgroundColor('#d1fae5')
              .padding({ left: 8, right: 8, top: 4, bottom: 4 })
              .borderRadius(12)
            
            Text('æ¸©æš–')
              .fontSize(12)
              .fontColor('#f59e0b')
              .backgroundColor('#fef3c7')
              .padding({ left: 8, right: 8, top: 4, bottom: 4 })
              .borderRadius(12)
          }
        }
        .margin({ right: 20 })

        // æ¬¢è¿ä¿¡æ¯
        Column() {
          Text(`äº²çˆ±çš„${this.userLevel},æ‚¨å¥½`)
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor('#1f2937')
            .margin({ bottom: 8 })
          
          Text('æ™ºèƒ½æ—…è¡Œå®¢æœéšæ—¶ä¸ºæ‚¨æœåŠ¡ >')
            .fontSize(14)
            .fontColor('#3b82f6')
            .onClick(() => {
              Prompt.showToast({ message: 'æ­£åœ¨è¿æ¥å®¢æœ...' })
            })
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)
      }
      .width('100%')
      .padding(20)
    }
    .width('100%')
    .backgroundColor('#e0f2fe')
    .borderRadius(16)
    .margin({ left: 16, right: 16, bottom: 12 })
  }

  @Builder CheckInCard() {
    Column() {
      Row() {
        Text('ğŸ“…')
          .fontSize(24)
          .margin({ right: 12 })
        
        Column() {
          Text('æ¯æ—¥ç­¾åˆ°')
            .fontSize(16)
            .fontWeight(FontWeight.Bold)
            .fontColor('#1f2937')
            .margin({ bottom: 4 })
          
          Text(`å·²è¿ç»­ç­¾åˆ° ${this.checkInDays} å¤©`)
            .fontSize(12)
            .fontColor('#6b7280')
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)

        Button(this.isCheckedIn ? 'å·²ç­¾åˆ°' : 'ç«‹å³ç­¾åˆ°')
          .fontSize(14)
          .fontColor(this.isCheckedIn ? '#6b7280' : '#ffffff')
          .backgroundColor(this.isCheckedIn ? '#f3f4f6' : '#3b82f6')
          .borderRadius(20)
          .padding({ left: 16, right: 16, top: 8, bottom: 8 })
          .enabled(!this.isCheckedIn)
          .onClick(() => {
            this.handleCheckIn()
          })
      }
      .width('100%')
      .padding(16)
    }
    .width('100%')
    .backgroundColor(Color.White)
    .borderRadius(16)
    .margin({ left: 16, right: 16, bottom: 12 })
    .shadow({
      radius: 4,
      color: 'rgba(0,0,0,0.05)',
      offsetX: 0,
      offsetY: 2
    })
  }

  @Builder OrderSelectionCard() {
    Column() {
      Text('è¯·é€‰æ‹©æ‚¨éœ€è¦å’¨è¯¢çš„è®¢å•')
        .fontSize(16)
        .fontWeight(FontWeight.Bold)
        .fontColor('#1f2937')
        .alignSelf(ItemAlign.Start)
        .margin({ bottom: 16 })

      Column({ space: 12 }) {
        ForEach(this.orderItems ?? [], (order: OrderItem, index: number) => {
          this.OrderItem(order, index)
        }, (order: OrderItem, index: number) => `order-${index}-${order.route}`)
      }
      .width('100%')

      Text('æŸ¥çœ‹å…¨éƒ¨è®¢å• >')
        .fontSize(14)
        .fontColor('#3b82f6')
        .margin({ top: 12 })
        .onClick(() => {
          Prompt.showToast({ message: 'æŸ¥çœ‹å…¨éƒ¨è®¢å•' })
        })
    }
    .width('100%')
    .padding(20)
    .backgroundColor(Color.White)
    .borderRadius(16)
    .margin({ left: 16, right: 16, bottom: 12 })
    .shadow({
      radius: 4,
      color: 'rgba(0,0,0,0.05)',
      offsetX: 0,
      offsetY: 2
    })
  }

  @Builder OrderItem(order: OrderItem, index: number) {
    Row() {
      // èˆªç­å›¾æ ‡
      Text('âœˆï¸')
        .fontSize(20)
        .margin({ right: 12 })

      // è®¢å•ä¿¡æ¯
      Column() {
        Text(order.route)
          .fontSize(16)
          .fontWeight(FontWeight.Bold)
          .fontColor('#1f2937')
          .margin({ bottom: 4 })
        
        Text(`${order.status} | ${order.date} ${order.time} ${order.flightNumber}`)
          .fontSize(12)
          .fontColor('#6b7280')
          .margin({ bottom: 4 })
        
        Text(order.price)
          .fontSize(14)
          .fontWeight(FontWeight.Bold)
          .fontColor('#ef4444')
      }
      .layoutWeight(1)
      .alignItems(HorizontalAlign.Start)

      // å®¢æœæŒ‰é’®
      Column() {
        Text('ğŸ§')
          .fontSize(20)
          .margin({ bottom: 4 })
        
        Text('å®¢æœ')
          .fontSize(12)
          .fontColor('#3b82f6')
      }
      .onClick(() => {
        Prompt.showToast({ message: `æ­£åœ¨ä¸ºè®¢å• ${order.route} è¿æ¥å®¢æœ...` })
      })

      // å¿«æ·æ“ä½œ
      Column({ space: 8 }) {
        Row({ space: 8 }) {
          ForEach((this.quickActions ?? []).slice(0, 2), (action: ServiceItem, index: number) => {
            Text(action.name)
              .fontSize(10)
              .fontColor('#6b7280')
              .backgroundColor('#f3f4f6')
              .padding({ left: 8, right: 8, top: 4, bottom: 4 })
              .borderRadius(8)
              .onClick(() => {
                Prompt.showToast({ message: action.name })
              })
          }, (action: ServiceItem, index: number) => `qa1-${index}-${action.name}`)
        }
        
        Row({ space: 8 }) {
          ForEach((this.quickActions ?? []).slice(2, 4), (action: ServiceItem, index: number) => {
            Text(action.name)
              .fontSize(10)
              .fontColor('#6b7280')
              .backgroundColor('#f3f4f6')
              .padding({ left: 8, right: 8, top: 4, bottom: 4 })
              .borderRadius(8)
              .onClick(() => {
                Prompt.showToast({ message: action.name })
              })
          }, (action: ServiceItem, index: number) => `qa2-${index}-${action.name}`)
        }
      }
      .margin({ top: 8 })
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#f8fafc')
    .borderRadius(12)
    .onClick(() => {
      Prompt.showToast({ message: `é€‰æ‹©è®¢å•ï¼š${order.route}` })
    })
  }

  @Builder QuickServiceCard() {
    Column() {
      Text('æ¨èæœåŠ¡')
        .fontSize(16)
        .fontWeight(FontWeight.Bold)
        .fontColor('#1f2937')
        .alignSelf(ItemAlign.Start)
        .margin({ bottom: 16 })

      Row({ space: 16 }) {
        ForEach((this.serviceItems ?? []).slice(0, 3), (service: ServiceItem, index: number) => {
          this.ServiceItem(service)
        }, (service: ServiceItem, index: number) => `svc-${index}-${service.name}`)
      }
      .width('100%')
      .justifyContent(FlexAlign.SpaceBetween)
    }
    .width('100%')
    .padding(20)
    .backgroundColor(Color.White)
    .borderRadius(16)
    .margin({ left: 16, right: 16, bottom: 12 })
    .shadow({
      radius: 4,
      color: 'rgba(0,0,0,0.05)',
      offsetX: 0,
      offsetY: 2
    })
  }

  @Builder ServiceItem(service: ServiceItem) {
    Column() {
      Text(service.icon)
        .fontSize(32)
        .margin({ bottom: 8 })
      
      Text(service.name)
        .fontSize(14)
        .fontWeight(FontWeight.Bold)
        .fontColor('#1f2937')
        .margin({ bottom: 4 })
      
      Text(service.description)
        .fontSize(10)
        .fontColor('#6b7280')
        .textAlign(TextAlign.Center)
    }
    .width(80)
    .height(100)
    .justifyContent(FlexAlign.Center)
    .onClick(() => {
      Prompt.showToast({ message: `ç‚¹å‡»äº†ï¼š${service.name}` })
    })
  }

  @Builder RecommendedServiceCard() {
    Column() {
      Text('æ›´å¤šæœåŠ¡')
        .fontSize(16)
        .fontWeight(FontWeight.Bold)
        .fontColor('#1f2937')
        .alignSelf(ItemAlign.Start)
        .margin({ bottom: 16 })

      GridRow({
        columns: 2,
        gutter: { x: 12, y: 12 }
      }) {
        ForEach(this.quickActions ?? [], (action: ServiceItem, index: number) => {
          GridCol({ span: 1 }) {
            this.ActionItem(action)
          }
        }, (action: ServiceItem, index: number) => `gridqa-${index}-${action.name}`)
      }
      .width('100%')
    }
    .width('100%')
    .padding(20)
    .backgroundColor(Color.White)
    .borderRadius(16)
    .margin({ left: 16, right: 16, bottom: 12 })
    .shadow({
      radius: 4,
      color: 'rgba(0,0,0,0.05)',
      offsetX: 0,
      offsetY: 2
    })
  }

  @Builder ActionItem(action: ServiceItem) {
    Row() {
      Text(action.icon)
        .fontSize(20)
        .margin({ right: 12 })
      
      Column() {
        Text(action.name)
          .fontSize(14)
          .fontWeight(FontWeight.Bold)
          .fontColor('#1f2937')
          .margin({ bottom: 2 })
        
        Text(action.description)
          .fontSize(12)
          .fontColor('#6b7280')
      }
      .layoutWeight(1)
      .alignItems(HorizontalAlign.Start)
    }
    .width('100%')
    .height(60)
    .padding(12)
    .backgroundColor('#f8fafc')
    .borderRadius(12)
    .onClick(() => {
      Prompt.showToast({ message: action.name })
    })
  }

  @Builder BottomServiceCard() {
    Row({ space: 20 }) {
      // åœ¨çº¿å®¢æœ
      Column() {
        Text('ğŸ§')
          .fontSize(32)
          .margin({ bottom: 8 })
        
        Text('åœ¨çº¿å®¢æœ')
          .fontSize(14)
          .fontWeight(FontWeight.Bold)
          .fontColor('#3b82f6')
      }
      .layoutWeight(1)
      .height(80)
      .backgroundColor('#dbeafe')
      .borderRadius(16)
      .justifyContent(FlexAlign.Center)
      .onClick(() => {
        Prompt.showToast({ message: 'æ­£åœ¨è¿æ¥åœ¨çº¿å®¢æœ...' })
      })

      // ç”µè¯å®¢æœ
      Column() {
        Text('ğŸ“')
          .fontSize(32)
          .margin({ bottom: 8 })
        
        Text('ç”µè¯å®¢æœ')
          .fontSize(14)
          .fontWeight(FontWeight.Bold)
          .fontColor('#10b981')
      }
      .layoutWeight(1)
      .height(80)
      .backgroundColor('#d1fae5')
      .borderRadius(16)
      .justifyContent(FlexAlign.Center)
      .onClick(() => {
        Prompt.showToast({ message: 'æ­£åœ¨æ‹¨æ‰“å®¢æœç”µè¯...' })
      })
    }
    .width('100%')
    .padding(20)
    .backgroundColor(Color.White)
    .borderRadius(16)
    .margin({ left: 16, right: 16 })
    .shadow({
      radius: 4,
      color: 'rgba(0,0,0,0.05)',
      offsetX: 0,
      offsetY: 2
    })
  }

  private handleCheckIn() {
    this.isCheckedIn = true
    this.checkInDays += 1
    
    Prompt.showToast({ 
      message: `ç­¾åˆ°æˆåŠŸï¼è¿ç»­ç­¾åˆ° ${this.checkInDays} å¤©ï¼Œè·å¾— 10 ç§¯åˆ†` 
    })
  }
}
