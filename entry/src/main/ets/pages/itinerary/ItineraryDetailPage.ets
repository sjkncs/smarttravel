import { router } from '@kit.ArkUI';
import { TopNavigationBar } from '../../components/TopNavigationBar';

interface DayPlan {
  day: number;
  date: string;
  activities: ActivityItem[];
}

interface ActivityItem {
  time: string;
  title: string;
  location: string;
  description: string;
  icon: string;
}

@Entry
@Component
export struct ItineraryDetailPage {
  @State itineraryId: string = '';
  @State itineraryTitle: string = 'æ·±åœ³ä¸‰æ—¥æ¸¸';
  @State startDate: string = '2024-12-01';
  @State endDate: string = '2024-12-03';
  @State days: number = 3;
  @State totalBudget: string = 'Â¥2,500';
  @State status: string = 'è¿›è¡Œä¸­';
  
  @State dayPlans: DayPlan[] = [
    {
      day: 1,
      date: '12æœˆ01æ—¥',
      activities: [
        { time: '09:00', title: 'æŠµè¾¾æ·±åœ³', location: 'æ·±åœ³å®å®‰æœºåœº', description: 'ä¹˜åæ—©ç­é£æœºæŠµè¾¾', icon: 'âœˆï¸' },
        { time: '11:00', title: 'é…’åº—å…¥ä½', location: 'æ·±åœ³æ¹¾ä¸‡è±ªé…’åº—', description: 'åŠç†å…¥ä½æ‰‹ç»­', icon: 'ğŸ¨' },
        { time: '15:00', title: 'æ·±åœ³æ¹¾å…¬å›­', location: 'å—å±±åŒº', description: 'æ¼«æ­¥æµ·æ»¨æ ˆé“', icon: 'ğŸï¸' }
      ]
    },
    {
      day: 2,
      date: '12æœˆ02æ—¥',
      activities: [
        { time: '09:00', title: 'ä¸–ç•Œä¹‹çª—', location: 'åä¾¨åŸ', description: 'æ¸¸è§ˆä¸–ç•Œæ™¯ç‚¹', icon: 'ğŸŒ' },
        { time: '14:00', title: 'æ¬¢ä¹è°·', location: 'å—å±±åŒº', description: 'ä½“éªŒæ¸¸ä¹é¡¹ç›®', icon: 'ğŸ¢' }
      ]
    }
  ];

  aboutToAppear() {
    const params = router.getParams() as Record<string, string>;
    if (params && params.id) {
      this.itineraryId = params.id;
    }
  }

  build() {
    Column() {
      TopNavigationBar({
        title: 'è¡Œç¨‹è¯¦æƒ…',
        showBack: true
      })

      Scroll() {
        Column() {
          this.HeaderCard()
          this.DayPlanList()
        }
        .width('100%')
      }
      .layoutWeight(1)
      .scrollBar(BarState.Off)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#f8fafc')
  }

  @Builder HeaderCard() {
    Column() {
      Text(this.itineraryTitle)
        .fontSize(22)
        .fontWeight(FontWeight.Bold)
        .fontColor('#1f2937')
        .margin({ bottom: 16 })

      Row() {
        Column() {
          Text(this.days.toString())
            .fontSize(24)
            .fontWeight(FontWeight.Bold)
            .fontColor('#3b82f6')
          Text('å¤©æ•°')
            .fontSize(12)
            .fontColor('#6b7280')
        }
        .layoutWeight(1)

        Column() {
          Text(this.totalBudget)
            .fontSize(24)
            .fontWeight(FontWeight.Bold)
            .fontColor('#10b981')
          Text('é¢„ç®—')
            .fontSize(12)
            .fontColor('#6b7280')
        }
        .layoutWeight(1)

        Column() {
          Text(this.status)
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor('#f59e0b')
          Text('çŠ¶æ€')
            .fontSize(12)
            .fontColor('#6b7280')
        }
        .layoutWeight(1)
      }
      .width('100%')
    }
    .width('100%')
    .padding(20)
    .backgroundColor(Color.White)
    .margin({ bottom: 12 })
    .alignItems(HorizontalAlign.Start)
  }

  @Builder DayPlanList() {
    Column({ space: 12 }) {
      ForEach(this.dayPlans, (dayPlan: DayPlan) => {
        this.DayPlanCard(dayPlan)
      })
    }
    .width('100%')
    .padding({ left: 16, right: 16, bottom: 20 })
  }

  @Builder DayPlanCard(dayPlan: DayPlan) {
    Column() {
      Text(`ç¬¬${dayPlan.day}å¤© - ${dayPlan.date}`)
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .fontColor('#1f2937')
        .margin({ bottom: 12 })
        .alignSelf(ItemAlign.Start)

      Column({ space: 16 }) {
        ForEach(dayPlan.activities, (activity: ActivityItem) => {
          this.ActivityItem(activity)
        })
      }
      .width('100%')
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
    .alignItems(HorizontalAlign.Start)
  }

  @Builder ActivityItem(activity: ActivityItem) {
    Row() {
      Text(activity.icon)
        .fontSize(32)
        .width(50)
        .textAlign(TextAlign.Center)
        .margin({ right: 12 })

      Column() {
        Row() {
          Text(activity.time)
            .fontSize(14)
            .fontColor('#6b7280')
            .layoutWeight(1)
        }
        .width('100%')
        .margin({ bottom: 6 })

        Text(activity.title)
          .fontSize(16)
          .fontWeight(FontWeight.Bold)
          .fontColor('#1f2937')
          .margin({ bottom: 4 })
          .alignSelf(ItemAlign.Start)

        Text(`ğŸ“ ${activity.location}`)
          .fontSize(13)
          .fontColor('#6b7280')
          .margin({ bottom: 4 })
          .alignSelf(ItemAlign.Start)

        Text(activity.description)
          .fontSize(13)
          .fontColor('#9ca3af')
          .alignSelf(ItemAlign.Start)
      }
      .layoutWeight(1)
      .alignItems(HorizontalAlign.Start)
    }
    .width('100%')
    .alignItems(VerticalAlign.Top)
  }
}
