/**
 * ÂØºËà™ÊµãËØïÈ°µÈù¢ - Âø´ÈÄüËÆøÈóÆÊâÄÊúâÊà™ÂõæÈ°µÈù¢
 * Áî®‰∫éËØæÁ®ãËÆæËÆ°Â±ïÁ§∫ÂíåÊà™Âõæ
 */
import router from '@ohos.router'
import promptAction from '@ohos.promptAction'

@Entry
@Component
struct NavigationTestPage {
  @State currentSection: string = 'main'
  
  private mainPages: PageItem[] = [
    { title: '„ÄêÊà™Âõæ1„Äë‰∏ªÈ°µÈù¢', route: 'pages/MainPage', desc: 'Â∫ïÈÉ®ÂØºËà™Ê†è' } as PageItem,
    { title: '„ÄêÊà™Âõæ2„ÄëÈ¶ñÈ°µ‰ø°ÊÅØÊµÅ', route: 'pages/home/NewHomePage', desc: 'Banner+Âø´Êç∑ÂÖ•Âè£' } as PageItem,
  ]
  
  private categoryPages: PageItem[] = [
    { title: '„ÄêÊà™Âõæ4„ÄëÁæéÈ£üÂàóË°®', route: 'pages/category/FoodPage', desc: 'ÁæéÈ£üÂàÜÁ±ªÈ°µÈù¢' } as PageItem,
    { title: '„ÄêÊà™Âõæ5„ÄëÈÖíÂ∫óÂàóË°®', route: 'pages/category/HotelPage', desc: 'ÈÖíÂ∫óÂàÜÁ±ªÈ°µÈù¢' } as PageItem,
    { title: '„ÄêÊà™Âõæ6„ÄëË¥≠Áâ©ÂàóË°®', route: 'pages/category/ShoppingPage', desc: 'Ë¥≠Áâ©ÂàÜÁ±ªÈ°µÈù¢' } as PageItem,
  ]
  
  private activityPages: PageItem[] = this.createActivityPages()
  private mapPages: PageItem[] = this.createMapPages()
  private hotelPages: PageItem[] = this.createHotelPages()
  private profilePages: PageItem[] = this.createProfilePages()
  private searchPages: PageItem[] = this.createSearchPages()
  private detailPages: PageItem[] = this.createDetailPages()
  private specialPages: PageItem[] = this.createSpecialPages()

  private createActivityPages(): PageItem[] {
    return [
      { title: '„ÄêÊà™Âõæ7-8„ÄëÊ¥ªÂä®ËØ¶ÊÉÖ', route: 'pages/activity/ActivityDetailPage', desc: 'Ê¥ªÂä®ËØ¶ÊÉÖ+Êä•ÂêçÊµÆÂ±Ç' } as PageItem,
      { title: 'Ê¥ªÂä®ÂàóË°®', route: 'pages/activity/ActivityPage', desc: 'Ê¥ªÂä®ÂàóË°®È°µÈù¢' } as PageItem,
    ]
  }

  private createMapPages(): PageItem[] {
    return [
      { title: '„ÄêÊà™Âõæ10„ÄëÂú∞Âõæ‰∏ªÈ°µ', route: 'pages/map/MapPage', desc: 'Âú∞Âõæ+Ê∞îÊ≥°ÊèêÈÜí' } as PageItem,
      { title: '„ÄêÊà™Âõæ12„ÄëË∑ØÁ∫øËßÑÂàí', route: 'pages/transport/RouteNavigationPage', desc: 'Âú∞ÂùÄ‰∫§Êç¢Âä®Áîª' } as PageItem,
    ]
  }

  private createHotelPages(): PageItem[] {
    return [
      { title: '„ÄêÊà™Âõæ14„ÄëÈÖíÂ∫óÊêúÁ¥¢', route: 'pages/hotel/HotelSearchPage', desc: 'ÊêúÁ¥¢Á≠õÈÄâ' } as PageItem,
      { title: '„ÄêÊà™Âõæ15„ÄëÈÖíÂ∫óËØ¶ÊÉÖ', route: 'pages/hotel/HotelDetailPage', desc: 'ËØ¶ÊÉÖÈ°µ' } as PageItem,
      { title: '„ÄêÊà™Âõæ16„ÄëËÆ¢ÂçïÁ°ÆËÆ§', route: 'pages/hotel/HotelBookingPage', desc: 'È¢ÑËÆ¢Á°ÆËÆ§' } as PageItem,
      { title: '„ÄêÊà™Âõæ17„ÄëÊàëÁöÑËÆ¢Âçï', route: 'pages/order/HotelOrderPage', desc: 'ËÆ¢ÂçïÂàóË°®' } as PageItem,
    ]
  }

  private createProfilePages(): PageItem[] {
    return [
      { title: '„ÄêÊà™Âõæ18-19„Äë‰∏™‰∫∫‰∏≠ÂøÉ', route: 'pages/profile/ProfilePage', desc: 'Áî®Êà∑‰ø°ÊÅØ+ÂäüËÉΩ' } as PageItem,
      { title: '„ÄêÊà™Âõæ20„ÄëÊä•ÂêçÊÉÖÂÜµ', route: 'pages/profile/RegistrationStatusPage', desc: 'Êä•ÂêçËÆ∞ÂΩï' } as PageItem,
      { title: '„ÄêÊà™Âõæ21„ÄëÊàëÁöÑËÆ¢Âçï', route: 'pages/order/HotelOrderPage', desc: 'ËÆ¢ÂçïÁÆ°ÁêÜ' } as PageItem,
    ]
  }

  private createSearchPages(): PageItem[] {
    return [
      { title: '„ÄêÊà™Âõæ22-23„ÄëÊêúÁ¥¢È°µÈù¢', route: 'pages/search/SearchPage', desc: 'ÊêúÁ¥¢+ÁªìÊûú' } as PageItem,
    ]
  }

  private createDetailPages(): PageItem[] {
    return [
      { title: '„ÄêÊà™Âõæ24„ÄëÁæéÈ£üËØ¶ÊÉÖ', route: 'pages/detail/FoodDetailPage', desc: 'È§êÂéÖËØ¶ÊÉÖ' } as PageItem,
      { title: '„ÄêÊà™Âõæ25„ÄëÊôØÁÇπËØ¶ÊÉÖ', route: 'pages/activity/ActivityDetailPage', desc: 'ÊôØÁÇπËØ¶ÊÉÖ' } as PageItem,
    ]
  }

  private createSpecialPages(): PageItem[] {
    return [
      { title: '„ÄêÊà™Âõæ26„ÄëËØ≠Èü≥ËÆ≤Ëß£', route: 'pages/attraction/AttractionAudioPage', desc: 'ËØ≠Èü≥ËÆ≤Ëß£ÁïåÈù¢' } as PageItem,
      { title: 'ARÂØºËà™', route: 'pages/ar/ARNavigationPage', desc: 'ARÂØºËà™ÂäüËÉΩ' } as PageItem,
    ]
  }
  
  build() {
    Column() {
      // È°∂ÈÉ®Ê†áÈ¢òÊ†è
      Row() {
        Text('üì∏ Êà™ÂõæÂØºËà™ÊµãËØï')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .fontColor(Color.White)
      }
      .width('100%')
      .height(56)
      .padding({ left: 16, right: 16 })
      .backgroundColor('#3b82f6')
      
      // ÂàÜÁ±ªTab
      Scroll() {
        Row({ space: 12 }) {
          this.TabButton('‰∏ªË¶ÅÈ°µÈù¢', 'main')
          this.TabButton('ÂàÜÁ±ªÈ°µÈù¢', 'category')
          this.TabButton('Ê¥ªÂä®Ê®°Âùó', 'activity')
          this.TabButton('Âú∞ÂõæÂØºËà™', 'map')
          this.TabButton('ÈÖíÂ∫óÈ¢ÑËÆ¢', 'hotel')
          this.TabButton('‰∏™‰∫∫‰∏≠ÂøÉ', 'profile')
          this.TabButton('ÊêúÁ¥¢ÂäüËÉΩ', 'search')
          this.TabButton('ËØ¶ÊÉÖÈ°µÈù¢', 'detail')
          this.TabButton('ÁâπËâ≤ÂäüËÉΩ', 'special')
        }
        .padding(12)
      }
      .scrollable(ScrollDirection.Horizontal)
      .scrollBar(BarState.Off)
      .backgroundColor('#f5f5f5')
      
      // ÂÜÖÂÆπÂå∫Âüü
      Scroll() {
        Column({ space: 12 }) {
          this.renderCurrentSection()
        }
        .width('100%')
        .padding(16)
      }
      .layoutWeight(1)
      .backgroundColor('#f9fafb')
    }
    .width('100%')
    .height('100%')
  }
  
  @Builder TabButton(title: string, section: string) {
    Text(title)
      .fontSize(14)
      .fontColor(this.currentSection === section ? Color.White : '#333333')
      .padding({ left: 16, right: 16, top: 8, bottom: 8 })
      .backgroundColor(this.currentSection === section ? '#3b82f6' : Color.White)
      .borderRadius(16)
      .onClick(() => {
        this.currentSection = section
      })
  }
  
  // Ëé∑ÂèñÂΩìÂâçÁ´†ËäÇÁöÑÈ°µÈù¢ÂàóË°®
  private getCurrentPages(): PageItem[] {
    switch (this.currentSection) {
      case 'main': return this.mainPages
      case 'category': return this.categoryPages
      case 'activity': return this.activityPages
      case 'map': return this.mapPages
      case 'hotel': return this.hotelPages
      case 'profile': return this.profilePages
      case 'search': return this.searchPages
      case 'detail': return this.detailPages
      case 'special': return this.specialPages
      default: return []
    }
  }
  
  // Ëé∑ÂèñÂΩìÂâçÁ´†ËäÇÊ†áÈ¢ò
  private getSectionTitle(): string {
    switch (this.currentSection) {
      case 'main': return '‰∏ªË¶ÅÈ°µÈù¢'
      case 'category': return 'ÂàÜÁ±ªÈ°µÈù¢'
      case 'activity': return 'Ê¥ªÂä®Ê®°Âùó'
      case 'map': return 'Âú∞ÂõæÂØºËà™'
      case 'hotel': return 'ÈÖíÂ∫óÈ¢ÑËÆ¢'
      case 'profile': return '‰∏™‰∫∫‰∏≠ÂøÉ'
      case 'search': return 'ÊêúÁ¥¢ÂäüËÉΩ'
      case 'detail': return 'ËØ¶ÊÉÖÈ°µÈù¢'
      case 'special': return 'ÁâπËâ≤ÂäüËÉΩ'
      default: return ''
    }
  }
  
  @Builder renderCurrentSection() {
    Column() {
      // Á´†ËäÇÊ†áÈ¢ò
      Text(this.getSectionTitle())
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .margin({ bottom: 12 })
        .alignSelf(ItemAlign.Start)
      
      // È°µÈù¢ÂàóË°®
      ForEach(this.getCurrentPages(), (item: PageItem) => {
        this.PageCard(item)
      })
    }
  }
  
  @Builder PageCard(item: PageItem) {
    Column() {
      Row() {
        Column() {
          Text(item.title)
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor('#1f2937')
            .margin({ bottom: 4 })
          
          Text(item.desc)
            .fontSize(14)
            .fontColor('#6b7280')
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)
        
        Text('‚Üí')
          .fontSize(20)
          .fontColor('#9ca3af')
      }
      .width('100%')
      .padding(16)
    }
    .width('100%')
    .backgroundColor(Color.White)
    .borderRadius(12)
    .shadow({ radius: 4, color: 'rgba(0,0,0,0.05)', offsetY: 2 })
    .onClick(() => {
      this.navigateTo(item.route, item.params)
    })
  }
  
  private navigateTo(route: string, params?: Record<string, Object>) {
    try {
      router.pushUrl({
        url: route,
        params: params || ({} as Record<string, Object>)
      })
    } catch (error) {
      promptAction.showToast({
        message: `È°µÈù¢Ë∑≥ËΩ¨Â§±Ë¥•: ${route}`,
        duration: 2000
      })
      console.error('Navigation error:', error)
    }
  }
}

interface PageItem {
  title: string
  route: string
  desc: string
  params?: Record<string, Object>
}
