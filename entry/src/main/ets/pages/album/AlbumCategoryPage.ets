import { router } from '@kit.ArkUI';
import { TopNavigationBar } from '../../components/TopNavigationBar';

interface PhotoItem {
  id: string;
  url: string;
  title: string;
  location: string;
  date: string;
  likes: number;
  comments: number;
}

@Entry
@Component
export struct AlbumCategoryPage {
  @State categoryId: string = '';
  @State categoryName: string = 'è‡ªç„¶é£å…‰';
  @State photoCount: number = 15;
  
  @State photoList: PhotoItem[] = [
    {
      id: '1',
      url: 'https://picsum.photos/300/200?random=20',
      title: 'æ·±åœ³æ¹¾æ—¥å‡º',
      location: 'æ·±åœ³æ¹¾å…¬å›­',
      date: '2024-06-01',
      likes: 128,
      comments: 23
    },
    {
      id: '2',
      url: 'https://picsum.photos/300/200?random=21',
      title: 'è²èŠ±å±±æ™¨é›¾',
      location: 'è²èŠ±å±±å…¬å›­',
      date: '2024-06-02',
      likes: 95,
      comments: 15
    },
    {
      id: '3',
      url: 'https://picsum.photos/300/200?random=22',
      title: 'ä¸œæ¹–è·èŠ±',
      location: 'ä¸œæ¹–å…¬å›­',
      date: '2024-06-03',
      likes: 156,
      comments: 31
    },
    {
      id: '4',
      url: 'https://picsum.photos/300/200?random=23',
      title: 'å¤§é¹å±±æµ·æ™¯',
      location: 'å¤§é¹åŠå²›',
      date: '2024-06-04',
      likes: 203,
      comments: 42
    },
    {
      id: '5',
      url: 'https://picsum.photos/300/200?random=24',
      title: 'æ¢§æ¡å±±äº‘æµ·',
      location: 'æ¢§æ¡å±±',
      date: '2024-06-05',
      likes: 187,
      comments: 35
    },
    {
      id: '6',
      url: 'https://picsum.photos/300/200?random=25',
      title: 'ä»™æ¹–æ¤ç‰©å›­',
      location: 'ä»™æ¹–æ¤ç‰©å›­',
      date: '2024-06-06',
      likes: 142,
      comments: 28
    },
    {
      id: '7',
      url: 'https://picsum.photos/300/200?random=26',
      title: 'çº¢æ ‘æ—æ¹¿åœ°',
      location: 'ç¦ç”°çº¢æ ‘æ—',
      date: '2024-06-07',
      likes: 165,
      comments: 31
    },
    {
      id: '8',
      url: 'https://picsum.photos/300/200?random=27',
      title: 'æ¨æ¢…å‘æµ·å²¸',
      location: 'å¤§é¹æ¨æ¢…å‘',
      date: '2024-06-08',
      likes: 218,
      comments: 46
    },
    {
      id: '9',
      url: 'https://picsum.photos/300/200?random=28',
      title: 'ç¬”æ¶å±±å…¬å›­',
      location: 'ç¬”æ¶å±±å…¬å›­',
      date: '2024-06-09',
      likes: 134,
      comments: 25
    },
    {
      id: '10',
      url: 'https://picsum.photos/300/200?random=29',
      title: 'é¦™èœœæ¹–å¤•é˜³',
      location: 'é¦™èœœå…¬å›­',
      date: '2024-06-10',
      likes: 176,
      comments: 33
    },
    {
      id: '11',
      url: 'https://picsum.photos/300/200?random=30',
      title: 'æ·±åœ³æ²³ç•”',
      location: 'æ·±åœ³æ²³',
      date: '2024-06-11',
      likes: 98,
      comments: 18
    },
    {
      id: '12',
      url: 'https://picsum.photos/300/200?random=31',
      title: 'è§‚æ¾œæ¹–é£å…‰',
      location: 'è§‚æ¾œæ¹–',
      date: '2024-06-12',
      likes: 112,
      comments: 22
    },
    {
      id: '13',
      url: 'https://picsum.photos/300/200?random=32',
      title: 'è¥¿æ¶Œæµ·æ»©',
      location: 'å¤§é¹è¥¿æ¶Œ',
      date: '2024-06-13',
      likes: 245,
      comments: 51
    },
    {
      id: '14',
      url: 'https://picsum.photos/300/200?random=33',
      title: 'ä¸ƒå¨˜å±±é£æ™¯',
      location: 'ä¸ƒå¨˜å±±',
      date: '2024-06-14',
      likes: 189,
      comments: 37
    },
    {
      id: '15',
      url: 'https://picsum.photos/300/200?random=34',
      title: 'æµ·ä¸Šä¸–ç•Œ',
      location: 'è›‡å£æµ·ä¸Šä¸–ç•Œ',
      date: '2024-06-15',
      likes: 156,
      comments: 29
    }
  ];

  aboutToAppear() {
    // ä»è·¯ç”±å‚æ•°è·å–åˆ†ç±»ID
    const params = router.getParams() as Record<string, string>;
    if (params && params.id) {
      this.categoryId = params.id;
      this.loadCategoryData(params.id);
    }
  }

  private loadCategoryData(id: string): void {
    // æ¨¡æ‹Ÿæ ¹æ®åˆ†ç±»IDåŠ è½½ä¸åŒçš„æ•°æ®
    switch (id) {
      case '1':
        this.categoryName = 'è‡ªç„¶é£å…‰';
        break;
      case '2':
        this.categoryName = 'åŸå¸‚å»ºç­‘';
        this.updateUrbanPhotos();
        break;
      case '3':
        this.categoryName = 'äººæ–‡çºªå®';
        this.updateCulturalPhotos();
        break;
      case '4':
        this.categoryName = 'ç¾é£Ÿæ¢åº—';
        this.updateFoodPhotos();
        break;
      default:
        this.categoryName = 'æˆ‘çš„ç›¸å†Œ';
    }
  }

  private updateUrbanPhotos(): void {
    this.photoList = [
      {
        id: '101',
        url: 'https://picsum.photos/300/200?random=40',
        title: 'å¹³å®‰é‡‘èä¸­å¿ƒ',
        location: 'ç¦ç”°CBD',
        date: '2024-05-01',
        likes: 234,
        comments: 45
      },
      {
        id: '102',
        url: 'https://picsum.photos/300/200?random=41',
        title: 'äº¬åŸº100å¤œæ™¯',
        location: 'ç½—æ¹–',
        date: '2024-05-02',
        likes: 198,
        comments: 38
      },
      {
        id: '103',
        url: 'https://picsum.photos/300/200?random=42',
        title: 'æ·±åœ³æ¹¾å¤§æ¡¥',
        location: 'å—å±±',
        date: '2024-05-03',
        likes: 267,
        comments: 52
      },
      {
        id: '104',
        url: 'https://picsum.photos/300/200?random=43',
        title: 'å¸‚æ°‘ä¸­å¿ƒ',
        location: 'ç¦ç”°',
        date: '2024-05-04',
        likes: 145,
        comments: 27
      },
      {
        id: '105',
        url: 'https://picsum.photos/300/200?random=44',
        title: 'åå¼ºåŒ—å•†åœˆ',
        location: 'åå¼ºåŒ—',
        date: '2024-05-05',
        likes: 189,
        comments: 34
      },
      {
        id: '106',
        url: 'https://picsum.photos/300/200?random=45',
        title: 'æ¬¢ä¹æµ·å²¸',
        location: 'å—å±±',
        date: '2024-05-06',
        likes: 212,
        comments: 41
      },
      {
        id: '107',
        url: 'https://picsum.photos/300/200?random=46',
        title: 'æ·±åœ³åŒ—ç«™',
        location: 'é¾™å',
        date: '2024-05-07',
        likes: 134,
        comments: 25
      },
      {
        id: '108',
        url: 'https://picsum.photos/300/200?random=47',
        title: 'æ·±ä¸šä¸ŠåŸ',
        location: 'ç¦ç”°',
        date: '2024-05-08',
        likes: 156,
        comments: 29
      }
    ];
  }

  private updateCulturalPhotos(): void {
    this.photoList = [
      {
        id: '201',
        url: 'https://picsum.photos/300/200?random=50',
        title: 'å®¢å®¶æ°‘å±…',
        location: 'é¾™å²—',
        date: '2024-04-01',
        likes: 167,
        comments: 31
      },
      {
        id: '202',
        url: 'https://picsum.photos/300/200?random=51',
        title: 'æ·±åœ³åšç‰©é¦†',
        location: 'ç¦ç”°',
        date: '2024-04-02',
        likes: 145,
        comments: 27
      },
      {
        id: '203',
        url: 'https://picsum.photos/300/200?random=52',
        title: 'æ–‡åŒ–åˆ›æ„å›­',
        location: 'å—å±±',
        date: '2024-04-03',
        likes: 198,
        comments: 36
      },
      {
        id: '204',
        url: 'https://picsum.photos/300/200?random=53',
        title: 'å¤§èŠ¬æ²¹ç”»æ‘',
        location: 'é¾™å²—',
        date: '2024-04-04',
        likes: 223,
        comments: 43
      },
      {
        id: '205',
        url: 'https://picsum.photos/300/200?random=54',
        title: 'è¡—å¤´è‰ºäººè¡¨æ¼”',
        location: 'åä¾¨åŸ',
        date: '2024-04-05',
        likes: 189,
        comments: 35
      },
      {
        id: '206',
        url: 'https://picsum.photos/300/200?random=55',
        title: 'å¤åŸå¢™é—å€',
        location: 'å—å¤´å¤åŸ',
        date: '2024-04-06',
        likes: 176,
        comments: 32
      },
      {
        id: '207',
        url: 'https://picsum.photos/300/200?random=56',
        title: 'èµ¶é›†æ—¥',
        location: 'è§‚æ¾œ',
        date: '2024-04-07',
        likes: 154,
        comments: 28
      },
      {
        id: '208',
        url: 'https://picsum.photos/300/200?random=57',
        title: 'éŸ³ä¹ä¼šç°åœº',
        location: 'æ·±åœ³éŸ³ä¹å…',
        date: '2024-04-08',
        likes: 201,
        comments: 39
      },
      {
        id: '209',
        url: 'https://picsum.photos/300/200?random=58',
        title: 'ä¼ ç»Ÿå·¥è‰ºå±•',
        location: 'ç”˜å‘å®¢å®¶å°é•‡',
        date: '2024-04-09',
        likes: 167,
        comments: 31
      },
      {
        id: '210',
        url: 'https://picsum.photos/300/200?random=59',
        title: 'èˆé¾™è¡¨æ¼”',
        location: 'ç½—æ¹–',
        date: '2024-04-10',
        likes: 235,
        comments: 47
      },
      {
        id: '211',
        url: 'https://picsum.photos/300/200?random=60',
        title: 'ä¹¦æ³•å±•è§ˆ',
        location: 'å…³å±±æœˆç¾æœ¯é¦†',
        date: '2024-04-11',
        likes: 142,
        comments: 26
      },
      {
        id: '212',
        url: 'https://picsum.photos/300/200?random=61',
        title: 'æ°‘ä¿—èŠ‚åº†',
        location: 'å¸‚æ°‘ä¸­å¿ƒ',
        date: '2024-04-12',
        likes: 189,
        comments: 35
      }
    ];
  }

  private updateFoodPhotos(): void {
    this.photoList = [
      {
        id: '301',
        url: 'https://picsum.photos/300/200?random=70',
        title: 'ç²¤å¼æ—©èŒ¶',
        location: 'ç½—æ¹–',
        date: '2024-03-01',
        likes: 256,
        comments: 51
      },
      {
        id: '302',
        url: 'https://picsum.photos/300/200?random=71',
        title: 'æµ·é²œå¤§é¤',
        location: 'å—å±±æµ·å²¸åŸ',
        date: '2024-03-02',
        likes: 298,
        comments: 62
      },
      {
        id: '303',
        url: 'https://picsum.photos/300/200?random=72',
        title: 'å·å‘³ç«é”…',
        location: 'ä¸œé—¨',
        date: '2024-03-03',
        likes: 234,
        comments: 48
      },
      {
        id: '304',
        url: 'https://picsum.photos/300/200?random=73',
        title: 'æ—¥å¼æ–™ç†',
        location: 'æµ·å²¸åŸ',
        date: '2024-03-04',
        likes: 267,
        comments: 54
      },
      {
        id: '305',
        url: 'https://picsum.photos/300/200?random=74',
        title: 'æ¸¯å¼ç”œå“',
        location: 'ç¦ç”°',
        date: '2024-03-05',
        likes: 189,
        comments: 37
      },
      {
        id: '306',
        url: 'https://picsum.photos/300/200?random=75',
        title: 'ç‰¹è‰²å°åƒ',
        location: 'ä¸œé—¨æ­¥è¡Œè¡—',
        date: '2024-03-06',
        likes: 212,
        comments: 42
      }
    ];
  }

  build() {
    Column() {
      TopNavigationBar({
        title: this.categoryName,
        showBack: true,
        showSearch: true
      })

      // åˆ†ç±»ç»Ÿè®¡ä¿¡æ¯
      Row() {
        Text(`å…± ${this.photoList.length} å¼ ç…§ç‰‡`)
          .fontSize(14)
          .fontColor('#6b7280')
      }
      .width('100%')
      .padding({ left: 16, right: 16, top: 12, bottom: 12 })
      .backgroundColor(Color.White)

      // ç…§ç‰‡ç½‘æ ¼
      Scroll() {
        GridRow({
          columns: 2,
          gutter: { x: 12, y: 12 }
        }) {
          ForEach(this.photoList, (photo: PhotoItem) => {
            GridCol({ span: 1 }) {
              this.PhotoCard(photo)
            }
          })
        }
        .width('100%')
        .padding({ left: 16, right: 16, top: 16, bottom: 20 })
      }
      .layoutWeight(1)
      .scrollBar(BarState.Off)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#f8fafc')
  }

  @Builder PhotoCard(photo: PhotoItem) {
    Column() {
      // ç…§ç‰‡
      Stack() {
        Image(photo.url)
          .width('100%')
          .height(200)
          .objectFit(ImageFit.Cover)
          .borderRadius(12)

        // äº’åŠ¨æ•°æ®
        Row() {
          Blank()
          Row({ space: 8 }) {
            Row({ space: 4 }) {
              Text('â¤ï¸')
                .fontSize(12)
              Text(photo.likes.toString())
                .fontSize(12)
                .fontColor(Color.White)
            }
            .padding({ left: 6, right: 6, top: 3, bottom: 3 })
            .backgroundColor('rgba(0,0,0,0.5)')
            .borderRadius(10)

            Row({ space: 4 }) {
              Text('ğŸ’¬')
                .fontSize(12)
              Text(photo.comments.toString())
                .fontSize(12)
                .fontColor(Color.White)
            }
            .padding({ left: 6, right: 6, top: 3, bottom: 3 })
            .backgroundColor('rgba(0,0,0,0.5)')
            .borderRadius(10)
          }
        }
        .width('100%')
        .padding(8)
      }
      .width('100%')

      // ç…§ç‰‡ä¿¡æ¯
      Column() {
        Text(photo.title)
          .fontSize(14)
          .fontWeight(FontWeight.Bold)
          .fontColor('#1f2937')
          .margin({ bottom: 4 })
          .maxLines(1)
          .textOverflow({ overflow: TextOverflow.Ellipsis })

        Text(`${photo.location} Â· ${photo.date}`)
          .fontSize(12)
          .fontColor('#6b7280')
      }
      .width('100%')
      .padding(12)
      .alignItems(HorizontalAlign.Start)
    }
    .width('100%')
    .backgroundColor(Color.White)
    .borderRadius(12)
    .shadow({
      radius: 4,
      color: 'rgba(0,0,0,0.05)',
      offsetX: 0,
      offsetY: 2
    })
    .onClick(() => {
      this.viewPhotoDetail(photo.id);
    })
  }

  private viewPhotoDetail(id: string): void {
    router.pushUrl({
      url: 'pages/photo/PhotoDetailPage',
      params: { id: id }
    }).catch((error: Error) => {
      console.error('è·³è½¬å¤±è´¥:', error.message);
    });
  }
}
