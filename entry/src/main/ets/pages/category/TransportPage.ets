import { router } from '@kit.ArkUI';
import { TopNavigationBar } from '../../components/TopNavigationBar';
import { ErrorHandler } from '../../utils/ErrorHandler';

interface TransportItem {
  id: string;
  name: string;
  type: 'åœ°é“' | 'å…¬äº¤' | 'å‡ºç§Ÿè½¦' | 'å…±äº«å•è½¦' | 'è‡ªé©¾';
  icon: string;
  description: string;
  price: string;
  time: string;
  tips: string[];
}

@Entry
@Component
export struct TransportPage {
  @State transportList: TransportItem[] = [
    {
      id: '1',
      name: 'æ·±åœ³åœ°é“',
      type: 'åœ°é“',
      icon: 'ğŸš‡',
      description: 'æ·±åœ³åœ°é“è¦†ç›–å…¨å¸‚ä¸»è¦åŒºåŸŸï¼Œæ–¹ä¾¿å¿«æ·',
      price: 'Â¥2-10',
      time: '6:00-23:00',
      tips: ['æ”¯æŒå¾®ä¿¡/æ”¯ä»˜å®æ‰«ç ', 'é«˜å³°æœŸè¾ƒæ‹¥æŒ¤', 'çº¿è·¯è¦†ç›–å¹¿æ³›']
    },
    {
      id: '2',
      name: 'å…¬äº¤è½¦',
      type: 'å…¬äº¤',
      icon: 'ğŸšŒ',
      description: 'å…¬äº¤çº¿è·¯å¯†é›†ï¼Œå¯åˆ°è¾¾å„æ™¯ç‚¹',
      price: 'Â¥2-5',
      time: '6:00-22:00',
      tips: ['æ”¯æŒç§»åŠ¨æ”¯ä»˜', 'çº¿è·¯è¾ƒå¤š', 'é€‚åˆçŸ­é€”å‡ºè¡Œ']
    },
    {
      id: '3',
      name: 'å‡ºç§Ÿè½¦/ç½‘çº¦è½¦',
      type: 'å‡ºç§Ÿè½¦',
      icon: 'ğŸš•',
      description: 'æ–¹ä¾¿å¿«æ·ï¼Œé€‚åˆé•¿è·ç¦»å‡ºè¡Œ',
      price: 'èµ·æ­¥Â¥10ï¼ŒæŒ‰é‡Œç¨‹è®¡è´¹',
      time: '24å°æ—¶',
      tips: ['æ”¯æŒçº¿ä¸Šå«è½¦', 'ä»·æ ¼è¾ƒé«˜', 'é€‚åˆæœ‰è¡Œææ—¶']
    },
    {
      id: '4',
      name: 'å…±äº«å•è½¦',
      type: 'å…±äº«å•è½¦',
      icon: 'ğŸš²',
      description: 'çŸ­é€”å‡ºè¡Œé¦–é€‰ï¼Œç¯ä¿å¥åº·',
      price: 'Â¥1.5/30åˆ†é’Ÿ',
      time: '24å°æ—¶',
      tips: ['æ‰«ç å³ç”¨', 'é€‚åˆçŸ­è·ç¦»', 'æ³¨æ„åœæ”¾ä½ç½®']
    },
    {
      id: '5',
      name: 'è‡ªé©¾ç§Ÿè½¦',
      type: 'è‡ªé©¾',
      icon: 'ğŸš—',
      description: 'è‡ªç”±çµæ´»ï¼Œé€‚åˆå¤šäººå‡ºè¡Œ',
      price: 'Â¥200-500/å¤©',
      time: '24å°æ—¶',
      tips: ['éœ€è¦é©¾ç…§', 'æ³¨æ„åœè½¦é—®é¢˜', 'é€‚åˆè¿œè·ç¦»å‡ºè¡Œ']
    }
  ];

  build() {
    Column() {
      TopNavigationBar({
        title: 'äº¤é€šå‡ºè¡Œ',
        showBack: true
      })

      // å‡ºè¡Œæ–¹å¼åˆ—è¡¨
      Scroll() {
        Column({ space: 12 }) {
          ForEach(this.transportList, (item: TransportItem) => {
            this.TransportCard(item)
          }, (item: TransportItem) => item.id)  // æ·»åŠ keyGenerator
        }
        .width('100%')
        .padding({ left: 16, right: 16, top: 16, bottom: 20 })
      }
      .layoutWeight(1)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#f8fafc')
  }

  @Builder TransportCard(item: TransportItem) {
    Column({ space: 12 }) {
      Row({ space: 12 }) {
        Flex({ justifyContent: FlexAlign.Center, alignItems: ItemAlign.Center }) {
          Text(item.icon)
            .fontSize(32)
        }
        .width(50)
        .height(50)
        .backgroundColor('#f0f4ff')
        .borderRadius(8)

        Column({ space: 6 }) {
          Row() {
            Text(item.name)
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .fontColor('#1f2937')
              .layoutWeight(1)

            Text(item.type)
              .fontSize(12)
              .fontColor('#6366f1')
              .backgroundColor('#eef2ff')
              .padding({ left: 8, right: 8, top: 4, bottom: 4 })
              .borderRadius(4)
          }
          .width('100%')

          Text(item.description)
            .fontSize(14)
            .fontColor('#6b7280')
            .width('100%')
            .maxLines(2)
            .textOverflow({ overflow: TextOverflow.Ellipsis })

          Row({ space: 16 }) {
            Row({ space: 4 }) {
              Text('ğŸ’°')
                .fontSize(14)
              Text(item.price)
                .fontSize(13)
                .fontColor('#ef4444')
            }

            Row({ space: 4 }) {
              Text('â°')
                .fontSize(14)
              Text(item.time)
                .fontSize(13)
                .fontColor('#6b7280')
            }
          }
          .width('100%')
          .margin({ top: 4 })
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)
      }

      // å°è´´å£«
      if (item.tips && item.tips.length > 0) {
        Column({ space: 6 }) {
          Text('ğŸ’¡ å‡ºè¡Œå°è´´å£«')
            .fontSize(13)
            .fontWeight(FontWeight.Medium)
            .fontColor('#374151')
            .width('100%')

          Column({ space: 4 }) {
            ForEach(item.tips, (tip: string, index: number) => {
              Row({ space: 6 }) {
                Text('â€¢')
                  .fontSize(12)
                  .fontColor('#9ca3af')
                Text(tip)
                  .fontSize(12)
                  .fontColor('#6b7280')
                  .layoutWeight(1)
              }
              .width('100%')
            }, (tip: string, index: number) => `${item.id}-tip-${index}`)  // æ·»åŠ keyGenerator
          }
        }
        .width('100%')
        .padding(10)
        .backgroundColor('#f9fafb')
        .borderRadius(8)
      }
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
    .shadow({
      radius: 4,
      color: 'rgba(0,0,0,0.08)',
      offsetX: 0,
      offsetY: 2
    })
    .onClick(() => {
      ErrorHandler.safeExecute(async (): Promise<void> => {
        await router.pushUrl({
          url: 'pages/transport/TransportDetailPage',
          params: { 
            id: item.id,
            name: item.name,
            type: item.type
          }
        });
      }, (error: Error): void => ErrorHandler.handleRouterError(error, 'äº¤é€šè¯¦æƒ…é¡µé¢'));
    })
  }
}

